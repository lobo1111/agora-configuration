<?xml version="1.0" encoding="UTF-8"?> 
<databaseChangeLog 
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd"> 
    <changeSet author='tkopacki' id='scripts'>
        <sql>   
            CREATE TABLE IF NOT EXISTS `script` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name` varchar(45) COLLATE utf8_polish_ci NOT NULL,
            `script` text COLLATE utf8_polish_ci,
            `on_init` text COLLATE utf8_polish_ci,
            PRIMARY KEY (`id`),
            UNIQUE KEY `name_UNIQUE` (`name`)
            ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;

            CREATE TABLE IF NOT EXISTS `script_scheduler` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name` varchar(45) COLLATE utf8_polish_ci NOT NULL,
            `id_script` int(11) NOT NULL,
            `enabled` tinyint(1) NOT NULL,
            `schedule` varchar(45) COLLATE utf8_polish_ci NOT NULL,
            PRIMARY KEY (`id`),
            UNIQUE KEY `name_UNIQUE` (`name`),
            KEY `scheduler_script_fkey` (`id_script`)
            ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
            
            CREATE TABLE IF NOT EXISTS `script_dependency` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `script_id` int(11) NOT NULL,
            `dependency` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
            
            ALTER TABLE `script_dependency`
            ADD CONSTRAINT `script_dependency_script_fkey` FOREIGN KEY (`script_id`) REFERENCES `script` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
            
            ALTER TABLE `script_dependency`
            ADD CONSTRAINT `script_dependency_dependency_fkey` FOREIGN KEY (`dependency`) REFERENCES `script` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;

            ALTER TABLE `script_scheduler`
            ADD CONSTRAINT `scheduler_script_fkey` FOREIGN KEY (`id_script`) REFERENCES `script` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='script-security'>
        <sql> 
            CREATE TABLE IF NOT EXISTS `script_security` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `script_id` int(11) NOT NULL,
            `group_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
            
            ALTER TABLE `script_security`
            ADD CONSTRAINT `script_security_script_fkey` FOREIGN KEY (`script_id`) REFERENCES `script` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
            
            ALTER TABLE `script_security`
            ADD CONSTRAINT `script_security_group_fkey` FOREIGN KEY `group_id` REFERENCES `group` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
</databaseChangeLog>