<?xml version="1.0" encoding="UTF-8"?> 
<databaseChangeLog 
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd"> 
    <changeSet author='tkopacki' id='bank-table'>
        <sql> 
            CREATE TABLE IF NOT EXISTS `bank` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name` varchar(150) COLLATE utf8_polish_ci NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='account-add-bank-column'>
        <sql>  
            ALTER TABLE `account` 
            ADD `bank_id` int(11) NOT NULL
        </sql>
    </changeSet>  
    
    <changeSet author='tkopacki' id='account-bank-fkey'>
        <sql> 
            ALTER TABLE `account`
            ADD CONSTRAINT `bank_id_fkey` FOREIGN KEY (`bank_id`) REFERENCES `bank` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='bank-add-key-column'>
        <sql>  
            ALTER TABLE `bank` 
            ADD `bankKey` varchar(150) NOT NULL
        </sql>
    </changeSet> 
    
    <changeSet author='tkopacki' id='bank-pocztowy-account-insert'>
        <sql> 
            INSERT INTO `account` (`bank_id`, `name`, `number`)
            SELECT id, 'Bank Pocztowy - konto główne', '321421343214324' FROM `bank` WHERE `bankKey` = 'BANK_POCZTOWY'
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='dictionary-account-type'>
        <sql>
            INSERT INTO `dictionary_type` (`type`) VALUES
            ('ACCOUNT_TYPE');
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='accounts-types'>
        <sql>
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'DEFAULT', 'Konto ogólne' FROM `dictionary_type` WHERE `type` = 'ACCOUNT_TYPE';
            
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'RENT', 'Konto czynszowe' FROM `dictionary_type` WHERE `type` = 'ACCOUNT_TYPE';
            
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'REPAIR_FUND', 'Fundusz remontowy' FROM `dictionary_type` WHERE `type` = 'ACCOUNT_TYPE';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='account-add-type-column'>
        <sql>  
            ALTER TABLE `account` 
            ADD `type_id` int(11) NOT NULL;
        </sql>
    </changeSet>  
    
    <changeSet author='tkopacki' id='account-update-types'>
        <sql>  
            UPDATE `account` SET type_id = (SELECT id FROM `dictionary` WHERE dictionaryKey = 'DEFAULT');
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='account-type-fkey'>
        <sql>  
            ALTER TABLE `account`
            ADD CONSTRAINT `account_type_fkey` FOREIGN KEY (`type_id`) REFERENCES `dictionary` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-table'>
        <sql> 
            CREATE TABLE IF NOT EXISTS `payment` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `possession_id` int(11) NOT NULL,
            `type_id` int(11) NOT NULL,
            `status_id` int(11) NOT NULL,
            `income` decimal(10,2) DEFAULT NULL,
            `description` varchar(255) COLLATE utf8_polish_ci NOT NULL,
            `auto` int(1) NOT NULL DEFAULT 0,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-possession-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `possession_fkey` FOREIGN KEY (`possession_id`) REFERENCES `possession` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-type-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `payment_type_fkey` FOREIGN KEY (`type_id`) REFERENCES `dictionary` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-status-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `payment_status_fkey` FOREIGN KEY (`status_id`) REFERENCES `dictionary` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-type'>
        <sql>
            INSERT INTO `dictionary_type` (`type`) VALUES
            ('PAYMENT_TYPE');
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payments-types-insert'>
        <sql>
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'RENT', 'Czynsz' FROM `dictionary_type` WHERE `type` = 'PAYMENT_TYPE';
            
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'REPAIR_FUND', 'Fundusz remontowy' FROM `dictionary_type` WHERE `type` = 'PAYMENT_TYPE';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payments-types-insert-auto'>
        <sql>
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'AUTO', 'Płatność automatyczna' FROM `dictionary_type` WHERE `type` = 'PAYMENT_TYPE';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-status'>
        <sql>
            INSERT INTO `dictionary_type` (`type`) VALUES
            ('PAYMENT_STATUS');
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payments-statuses-insert'>
        <sql>
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'NEW_PAYMENT', 'Nowa płatność' FROM `dictionary_type` WHERE `type` = 'PAYMENT_STATUS';
            
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'BOOKED', 'Zaksięgowana' FROM `dictionary_type` WHERE `type` = 'PAYMENT_STATUS';
            
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'CANCELED', 'Anulowana' FROM `dictionary_type` WHERE `type` = 'PAYMENT_STATUS';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-income-not-null'>
        <sql>  
            ALTER TABLE `payment`
            MODIFY `income` decimal(10,2) NOT NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-description-null'>
        <sql>  
            ALTER TABLE `payment`
            MODIFY `description` varchar(255) NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-table'>
        <sql> 
            CREATE TABLE IF NOT EXISTS `zpk` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `number` varchar(150) COLLATE utf8_polish_ci NOT NULL,
            `description` varchar(255) COLLATE utf8_polish_ci,
            `community_id` int(11) NOT NULL,
            `possession_id` int(11) NULL,
            `type_id` int(11) NOT NULL,
            `credit` decimal(10,2) DEFAULT 0,
            `debit` decimal(10,2) DEFAULT 0,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-community-fkey'>
        <sql>  
            ALTER TABLE `zpk`
            ADD CONSTRAINT `zpk_community_fkey` FOREIGN KEY (`community_id`) REFERENCES `community` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-possession-fkey'>
        <sql>  
            ALTER TABLE `zpk`
            ADD CONSTRAINT `zpk_possession_fkey` FOREIGN KEY (`possession_id`) REFERENCES `possession` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-type-fkey'>
        <sql>  
            ALTER TABLE `zpk`
            ADD CONSTRAINT `zpk_type_fkey` FOREIGN KEY (`type_id`) REFERENCES `dictionary` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-credit-debit-remove'>
        <sql>  
            ALTER TABLE `zpk`
            DROP COLUMN credit;
            ALTER TABLE `zpk`
            DROP COLUMN debit;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-auto-removed'>
        <sql>  
            ALTER TABLE `payment`
            DROP COLUMN auto;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-booked-balance-columns-add'>
        <sql>  
            ALTER TABLE `payment`
            ADD COLUMN booked boolean DEFAULT false;
            ALTER TABLE `payment`
            ADD COLUMN create_day date DEFAULT NULL;
            ALTER TABLE `payment`
            ADD COLUMN booking_day date DEFAULT NULL;
            ALTER TABLE `payment`
            ADD COLUMN balance_id int(11) NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-zpk-balance'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `zpk_balance` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `credit` decimal(10,2) DEFAULT 0,
            `debit` decimal(10,2) DEFAULT 0,
            `start_credit` decimal(10,2) DEFAULT 0,
            `start_debit` decimal(10,2) DEFAULT 0,
            `zpk_id` int(11) NOT NULL,
            `booking_period_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table0booking-period'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `booking_period` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `default` boolean DEFAULT false,
            `name`  varchar(255) COLLATE utf8_polish_ci,
            `active` boolean DEFAULT true,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-zpk-balance-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `payment_zbk_balance_fkey` FOREIGN KEY (`balance_id`) REFERENCES `zpk_balance` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-balance-zpk-fkey'>
        <sql>  
            ALTER TABLE `zpk_balance`
            ADD CONSTRAINT `zbk_balance_zpk_fkey` FOREIGN KEY (`zpk_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-balance-booking-period-fkey'>
        <sql>  
            ALTER TABLE `zpk_balance`
            ADD CONSTRAINT `zbk_balance_booking_period_fkey` FOREIGN KEY (`booking_period_id`) REFERENCES `booking_period` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-type-column-drop'>
        <sql> 
            ALTER TABLE `zpk` DROP FOREIGN KEY `zpk_type_fkey`;
            ALTER TABLE `zpk` DROP COLUMN `type_id`;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-default-booking-period'>
        <sql> 
            INSERT INTO `booking_period`(`default`, `name`, `active`) VALUES(true, 'domyślny', true);
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='drop-possession-account'>
        <sql> 
            DROP TABLE `possession_account;
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='zpk-person-column'>
        <sql> 
            ALTER TABLE `zpk`
            ADD COLUMN `person_id` int(11); 
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-company-column'>
        <sql> 
            ALTER TABLE `zpk`
            ADD COLUMN `company_id` int(11); 
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-person-fkey'>
        <sql>  
            ALTER TABLE `zpk`
            ADD CONSTRAINT `zbk_person_fkey` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-company-fkey'>
        <sql>  
            ALTER TABLE `zpk`
            ADD CONSTRAINT `zbk_company_fkey` FOREIGN KEY (`company_id`) REFERENCES `company` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='booking-period-refactoring'>
        <sql>  
            ALTER TABLE `booking_period` CHANGE `default` `default_period` boolean;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='bank-company-column'>
        <sql>  
            ALTER TABLE `bank` 
            ADD `company_id` int(11) NOT NULL
        </sql>
    </changeSet>  
    
    <changeSet author='tkopacki' id='bank-company-fkey'>
        <sql>  
            ALTER TABLE `bank`
            ADD CONSTRAINT `bank_company_fkey` FOREIGN KEY (`company_id`) REFERENCES `company` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-account-column'>
        <sql>  
            ALTER TABLE `payment` 
            ADD `account_id` int(11) NOT NULL
        </sql>
    </changeSet> 
    
    <changeSet author='tkopacki' id='payment-account-column-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `payment_account_column_fkey` FOREIGN KEY (`account_id`) REFERENCES `account` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-possession-column-fkey-drop'>
        <sql>  
            ALTER TABLE `payment` DROP FOREIGN KEY `possession_fkey`;
            ALTER TABLE `payment` DROP COLUMN `possession_id`;
        </sql>
    </changeSet> 
    
    <changeSet author='tkopacki' id='payment-direction-column'>
        <sql>
            ALTER TABLE `payment` ADD `direction` enum('INCOME', 'EXPENDITURE') NOT NULL DEFAULT 'INCOME';
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-payment-scheduler'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `payment_scheduler` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name`  varchar(255) COLLATE utf8_polish_ci,
            `active` boolean DEFAULT true,
            `day` varchar(20) NOT NULL DEFAULT 1,
            `community_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-community-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler`
            ADD CONSTRAINT `payment_scheduler_community_fkey` FOREIGN KEY (`community_id`) REFERENCES `community` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-log'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `payment_scheduler_log` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `payment_scheduler_id` int(11) NOT NULL,
            `fired_month` varchar(20) NOT NULL,
            `fired_year` varchar(20) NOT NULL,
            `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-log-scheduler-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_log`
            ADD CONSTRAINT `payment_scheduler_log_scheduler_fkey` FOREIGN KEY (`payment_scheduler_id`) REFERENCES `payment_scheduler` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `payment_scheduler_template` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `payment_scheduler_id` int(11) NOT NULL,
            `amount` decimal(10,2) NOT NULL,
            `account_id` int(11) NOT NULL,
            `description` varchar(255) NOT NULL,
            `type_id` int(11) NOT NULL,
            `auto_book` tinyint(1) NOT NULL,
            `zpk_account_id` int(11),
            `booking_period_id` int(11),
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-scheduler-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD CONSTRAINT `payment_scheduler_template_scheduler_fkey` FOREIGN KEY (`payment_scheduler_id`) REFERENCES `payment_scheduler` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-account-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD CONSTRAINT `payment_scheduler_template_account_fkey` FOREIGN KEY (`account_id`) REFERENCES `account` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-type-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD CONSTRAINT `payment_scheduler_template_type_fkey` FOREIGN KEY (`type_id`) REFERENCES `dictionary` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-period-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD CONSTRAINT `payment_scheduler_template_period_fkey` FOREIGN KEY (`booking_period_id`) REFERENCES `booking_period` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-zpk-account-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD CONSTRAINT `payment_scheduler_template_zpk_account_fkey` FOREIGN KEY (`zpk_account_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-account-drop-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template` DROP FOREIGN KEY `payment_scheduler_template_account_fkey`;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-account-drop-column'>
        <sql>  
            ALTER TABLE `payment_scheduler_template` DROP `account_id`;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-booking-period-drop-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template` DROP FOREIGN KEY `payment_scheduler_template_period_fkey`;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-period-drop-drop-column'>
        <sql>  
            ALTER TABLE `payment_scheduler_template` DROP `booking_period_id`;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-account-column-nullable'>
        <sql>  
            ALTER TABLE `payment` MODIFY `account_id` int(11) NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-booking-period-order-column'>
        <sql> 
            ALTER TABLE `booking_period`
            ADD COLUMN `period_order` int(11) NOT NULL DEFAULT 1; 
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-scheduler-zpk-drop-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template` DROP FOREIGN KEY `payment_scheduler_template_zpk_account_fkey`;
            ALTER TABLE `payment_scheduler_template` DROP COLUMN `zpk_account_id`;
        </sql>
    </changeSet> 
    
    <changeSet author='tkopacki' id='table-payment-scheduler-zpk'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `payment_scheduler_zpk` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `payment_scheduler_id` int(11) NOT NULL,
            `zpk_account_id` int(11),
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-zpk-scheduler-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_zpk`
            ADD CONSTRAINT `payment_scheduler_zpk_scheduler_fkey` FOREIGN KEY (`payment_scheduler_id`) REFERENCES `payment_scheduler` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-zpk-zpk-account-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_zpk`
            ADD CONSTRAINT `payment_scheduler_zpk_zpk_account_fkey` FOREIGN KEY (`zpk_account_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `auto_payment` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name` varchar(255) NOT NULL,
            `active` tinyint(1) NOT NULL,
            `zpk_account_id` int(11),
            `account_id` int(11),
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-zpk-account-fkey'>
        <sql>  
            ALTER TABLE `auto_payment`
            ADD CONSTRAINT `auto_payment_zpk_account_fkey` FOREIGN KEY (`zpk_account_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-account-fkey'>
        <sql>  
            ALTER TABLE `auto_payment`
            ADD CONSTRAINT `auto_payment_account_fkey` FOREIGN KEY (`account_id`) REFERENCES `account` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-order'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `auto_payment_order` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `auto_payment_id` int(11),
            `zpk_account_id` int(11),
            `payment_order` int(11) NOT NULL DEFAULT 1,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-order-zpk-account-fkey'>
        <sql>  
            ALTER TABLE `auto_payment_order`
            ADD CONSTRAINT `auto_payment_order_zpk_account_fkey` FOREIGN KEY (`zpk_account_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-order-auto_payment-fkey'>
        <sql>  
            ALTER TABLE `auto_payment_order`
            ADD CONSTRAINT `auto_payment_order_auto_payment_fkey` FOREIGN KEY (`auto_payment_id`) REFERENCES `auto_payment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-payment'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `auto_payment_payment` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `auto_payment_id` int(11),
            `payment_id` int(11),
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-auto-payment-fkey'>
        <sql>  
            ALTER TABLE `auto_payment_payment`
            ADD CONSTRAINT `auto_payment_payment_auto_payment_fkey` FOREIGN KEY (`auto_payment_id`) REFERENCES `auto_payment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-payment-fkey'>
        <sql>  
            ALTER TABLE `auto_payment_payment`
            ADD CONSTRAINT `auto_payment_payment_payment_fkey` FOREIGN KEY (`payment_id`) REFERENCES `payment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-incoming-payment-document-payment'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `incoming_payment_document_payment` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `incoming_payment_document_id` int(11),
            `payment_id` int(11),
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-incoming-payment-document-payment-fkey'>
        <sql>  
            ALTER TABLE `incoming_payment_document_payment`
            ADD CONSTRAINT `incoming_payment_document_payment_fkey` FOREIGN KEY (`payment_id`) REFERENCES `payment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-incoming-payment-document-incoming-payment-fkey'>
        <sql>  
            ALTER TABLE `incoming_payment_document_payment`
            ADD CONSTRAINT `incoming_payment_document_incoming_payment_fkey` FOREIGN KEY (`incoming_payment_document_id`) REFERENCES `incoming_payment_document` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-incoming-payment-document-payment-doc-id-drop'>
        <sql>  
            ALTER TABLE `incoming_payment_document_payment` DROP FOREIGN KEY `incoming_payment_document_incoming_payment_fkey`;
        </sql>
    </changeSet> 

    <changeSet author='tkopacki' id='table-incoming-payment-document-incoming-payment-change-fkey'>
        <sql>  
            ALTER TABLE `incoming_payment_document_payment`
            ADD CONSTRAINT `incoming_payment_document_incoming_payment_fkey` FOREIGN KEY (`incoming_payment_document_id`) REFERENCES `incoming_payment_document_position` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `obligation` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name` varchar(255) NOT NULL,
            `community_id` int(11) NOT NULL,
            `contractor_zpk_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-possession-zpk'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `obligation_possession_zpk` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `obligation_id` int(11) NOT NULL,
            `possession_zpk_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-obligation-log'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `obligation_log` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `obligation_id` int(11) NOT NULL,
            `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-community-fkey'>
        <sql>  
            ALTER TABLE `obligation`
            ADD CONSTRAINT `obligation_community_fkey` FOREIGN KEY (`community_id`) REFERENCES `community` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-contractor-fkey'>
        <sql>  
            ALTER TABLE `obligation`
            ADD CONSTRAINT `obligation_contractor_fkey` FOREIGN KEY (`contractor_zpk_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-possession-obligation-fkey'>
        <sql>  
            ALTER TABLE `obligation_possession_zpk`
            ADD CONSTRAINT `obligation_possession_obligation_fkey` FOREIGN KEY (`obligation_id`) REFERENCES `obligation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-possession-zpk-fkey'>
        <sql>  
            ALTER TABLE `obligation_possession_zpk`
            ADD CONSTRAINT `obligation_possession_zpk_fkey` FOREIGN KEY (`possession_zpk_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-log-obligation-fkey'>
        <sql>  
            ALTER TABLE `obligation_log`
            ADD CONSTRAINT `obligation_log_obligation_fkey` FOREIGN KEY (`obligation_id`) REFERENCES `obligation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-contractor_id'>
        <sql>  
            ALTER TABLE `obligation` 
            ADD `contractor_id` int(11) NOT NULL
        </sql>
    </changeSet> 
    
    <changeSet author='tkopacki' id='table-obligation-contractor-id-fkey'>
        <sql>  
            ALTER TABLE `obligation`
            ADD CONSTRAINT `obligation_contractor_id_fkey` FOREIGN KEY (`contractor_id`) REFERENCES `company` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
</databaseChangeLog>