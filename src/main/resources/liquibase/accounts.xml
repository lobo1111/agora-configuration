<?xml version="1.0" encoding="UTF-8"?> 
<databaseChangeLog 
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd"> 
    <changeSet author='tkopacki' id='bank-table'>
        <sql> 
            CREATE TABLE IF NOT EXISTS `bank` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name` varchar(150) COLLATE utf8_polish_ci NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='account-add-bank-column'>
        <sql>  
            ALTER TABLE `account` 
            ADD `bank_id` int(11) NOT NULL
        </sql>
    </changeSet>  
    
    <changeSet author='tkopacki' id='account-bank-fkey'>
        <sql> 
            ALTER TABLE `account`
            ADD CONSTRAINT `bank_id_fkey` FOREIGN KEY (`bank_id`) REFERENCES `bank` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='bank-add-key-column'>
        <sql>  
            ALTER TABLE `bank` 
            ADD `bankKey` varchar(150) NOT NULL
        </sql>
    </changeSet> 
    
    <changeSet author='tkopacki' id='bank-pocztowy-account-insert'>
        <sql> 
            INSERT INTO `account` (`bank_id`, `name`, `number`)
            SELECT id, 'Bank Pocztowy - konto główne', '321421343214324' FROM `bank` WHERE `bankKey` = 'BANK_POCZTOWY'
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='dictionary-account-type'>
        <sql>
            INSERT INTO `dictionary_type` (`type`) VALUES
            ('ACCOUNT_TYPE');
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='accounts-types'>
        <sql>
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'DEFAULT', 'Konto ogólne' FROM `dictionary_type` WHERE `type` = 'ACCOUNT_TYPE';
            
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'RENT', 'Konto czynszowe' FROM `dictionary_type` WHERE `type` = 'ACCOUNT_TYPE';
            
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'REPAIR_FUND', 'Fundusz remontowy' FROM `dictionary_type` WHERE `type` = 'ACCOUNT_TYPE';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='account-add-type-column'>
        <sql>  
            ALTER TABLE `account` 
            ADD `type_id` int(11) NOT NULL;
        </sql>
    </changeSet>  
    
    <changeSet author='tkopacki' id='account-update-types'>
        <sql>  
            UPDATE `account` SET type_id = (SELECT id FROM `dictionary` WHERE dictionaryKey = 'DEFAULT');
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='account-type-fkey'>
        <sql>  
            ALTER TABLE `account`
            ADD CONSTRAINT `account_type_fkey` FOREIGN KEY (`type_id`) REFERENCES `dictionary` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-table'>
        <sql> 
            CREATE TABLE IF NOT EXISTS `payment` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `possession_id` int(11) NOT NULL,
            `type_id` int(11) NOT NULL,
            `status_id` int(11) NOT NULL,
            `income` decimal(10,2) DEFAULT NULL,
            `description` varchar(255) COLLATE utf8_polish_ci NOT NULL,
            `auto` int(1) NOT NULL DEFAULT 0,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-possession-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `possession_fkey` FOREIGN KEY (`possession_id`) REFERENCES `possession` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-type-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `payment_type_fkey` FOREIGN KEY (`type_id`) REFERENCES `dictionary` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-status-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `payment_status_fkey` FOREIGN KEY (`status_id`) REFERENCES `dictionary` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-type'>
        <sql>
            INSERT INTO `dictionary_type` (`type`) VALUES
            ('PAYMENT_TYPE');
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payments-types-insert'>
        <sql>
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'RENT', 'Czynsz' FROM `dictionary_type` WHERE `type` = 'PAYMENT_TYPE';
            
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'REPAIR_FUND', 'Fundusz remontowy' FROM `dictionary_type` WHERE `type` = 'PAYMENT_TYPE';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payments-types-insert-auto'>
        <sql>
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'AUTO', 'Płatność automatyczna' FROM `dictionary_type` WHERE `type` = 'PAYMENT_TYPE';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-status'>
        <sql>
            INSERT INTO `dictionary_type` (`type`) VALUES
            ('PAYMENT_STATUS');
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payments-statuses-insert'>
        <sql>
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'NEW_PAYMENT', 'Nowa płatność' FROM `dictionary_type` WHERE `type` = 'PAYMENT_STATUS';
            
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'BOOKED', 'Zaksięgowana' FROM `dictionary_type` WHERE `type` = 'PAYMENT_STATUS';
            
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'CANCELED', 'Anulowana' FROM `dictionary_type` WHERE `type` = 'PAYMENT_STATUS';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-income-not-null'>
        <sql>  
            ALTER TABLE `payment`
            MODIFY `income` decimal(10,2) NOT NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-description-null'>
        <sql>  
            ALTER TABLE `payment`
            MODIFY `description` varchar(255) NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-table'>
        <sql> 
            CREATE TABLE IF NOT EXISTS `zpk` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `number` varchar(150) COLLATE utf8_polish_ci NOT NULL,
            `description` varchar(255) COLLATE utf8_polish_ci,
            `community_id` int(11) NOT NULL,
            `possession_id` int(11) NULL,
            `type_id` int(11) NOT NULL,
            `credit` decimal(10,2) DEFAULT 0,
            `debit` decimal(10,2) DEFAULT 0,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-community-fkey'>
        <sql>  
            ALTER TABLE `zpk`
            ADD CONSTRAINT `zpk_community_fkey` FOREIGN KEY (`community_id`) REFERENCES `community` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-possession-fkey'>
        <sql>  
            ALTER TABLE `zpk`
            ADD CONSTRAINT `zpk_possession_fkey` FOREIGN KEY (`possession_id`) REFERENCES `possession` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-type-fkey'>
        <sql>  
            ALTER TABLE `zpk`
            ADD CONSTRAINT `zpk_type_fkey` FOREIGN KEY (`type_id`) REFERENCES `dictionary` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-credit-debit-remove'>
        <sql>  
            ALTER TABLE `zpk`
            DROP COLUMN credit;
            ALTER TABLE `zpk`
            DROP COLUMN debit;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-auto-removed'>
        <sql>  
            ALTER TABLE `payment`
            DROP COLUMN auto;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-booked-balance-columns-add'>
        <sql>  
            ALTER TABLE `payment`
            ADD COLUMN booked boolean DEFAULT false;
            ALTER TABLE `payment`
            ADD COLUMN create_day date DEFAULT NULL;
            ALTER TABLE `payment`
            ADD COLUMN booking_day date DEFAULT NULL;
            ALTER TABLE `payment`
            ADD COLUMN balance_id int(11) NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-zpk-balance'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `zpk_balance` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `credit` decimal(10,2) DEFAULT 0,
            `debit` decimal(10,2) DEFAULT 0,
            `start_credit` decimal(10,2) DEFAULT 0,
            `start_debit` decimal(10,2) DEFAULT 0,
            `zpk_id` int(11) NOT NULL,
            `booking_period_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table0booking-period'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `booking_period` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `default` boolean DEFAULT false,
            `name`  varchar(255) COLLATE utf8_polish_ci,
            `active` boolean DEFAULT true,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-zpk-balance-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `payment_zbk_balance_fkey` FOREIGN KEY (`balance_id`) REFERENCES `zpk_balance` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-balance-zpk-fkey'>
        <sql>  
            ALTER TABLE `zpk_balance`
            ADD CONSTRAINT `zbk_balance_zpk_fkey` FOREIGN KEY (`zpk_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-balance-booking-period-fkey'>
        <sql>  
            ALTER TABLE `zpk_balance`
            ADD CONSTRAINT `zbk_balance_booking_period_fkey` FOREIGN KEY (`booking_period_id`) REFERENCES `booking_period` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-type-column-drop'>
        <sql> 
            ALTER TABLE `zpk` DROP FOREIGN KEY `zpk_type_fkey`;
            ALTER TABLE `zpk` DROP COLUMN `type_id`;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-default-booking-period'>
        <sql> 
            INSERT INTO `booking_period`(`default`, `name`, `active`) VALUES(true, 'domyślny', true);
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='drop-possession-account'>
        <sql> 
            DROP TABLE `possession_account;
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='zpk-person-column'>
        <sql> 
            ALTER TABLE `zpk`
            ADD COLUMN `person_id` int(11); 
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-company-column'>
        <sql> 
            ALTER TABLE `zpk`
            ADD COLUMN `company_id` int(11); 
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-person-fkey'>
        <sql>  
            ALTER TABLE `zpk`
            ADD CONSTRAINT `zbk_person_fkey` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='zpk-company-fkey'>
        <sql>  
            ALTER TABLE `zpk`
            ADD CONSTRAINT `zbk_company_fkey` FOREIGN KEY (`company_id`) REFERENCES `company` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='booking-period-refactoring'>
        <sql>  
            ALTER TABLE `booking_period` CHANGE `default` `default_period` boolean;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='bank-company-column'>
        <sql>  
            ALTER TABLE `bank` 
            ADD `company_id` int(11) NOT NULL
        </sql>
    </changeSet>  
    
    <changeSet author='tkopacki' id='bank-company-fkey'>
        <sql>  
            ALTER TABLE `bank`
            ADD CONSTRAINT `bank_company_fkey` FOREIGN KEY (`company_id`) REFERENCES `company` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-account-column'>
        <sql>  
            ALTER TABLE `payment` 
            ADD `account_id` int(11) NOT NULL
        </sql>
    </changeSet> 
    
    <changeSet author='tkopacki' id='payment-account-column-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `payment_account_column_fkey` FOREIGN KEY (`account_id`) REFERENCES `account` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-possession-column-fkey-drop'>
        <sql>  
            ALTER TABLE `payment` DROP FOREIGN KEY `possession_fkey`;
            ALTER TABLE `payment` DROP COLUMN `possession_id`;
        </sql>
    </changeSet> 
    
    <changeSet author='tkopacki' id='payment-direction-column'>
        <sql>
            ALTER TABLE `payment` ADD `direction` enum('INCOME', 'EXPENDITURE') NOT NULL DEFAULT 'INCOME';
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-payment-scheduler'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `payment_scheduler` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name`  varchar(255) COLLATE utf8_polish_ci,
            `active` boolean DEFAULT true,
            `day` varchar(20) NOT NULL DEFAULT 1,
            `community_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-community-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler`
            ADD CONSTRAINT `payment_scheduler_community_fkey` FOREIGN KEY (`community_id`) REFERENCES `community` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-log'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `payment_scheduler_log` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `payment_scheduler_id` int(11) NOT NULL,
            `fired_month` varchar(20) NOT NULL,
            `fired_year` varchar(20) NOT NULL,
            `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-log-scheduler-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_log`
            ADD CONSTRAINT `payment_scheduler_log_scheduler_fkey` FOREIGN KEY (`payment_scheduler_id`) REFERENCES `payment_scheduler` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `payment_scheduler_template` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `payment_scheduler_id` int(11) NOT NULL,
            `amount` decimal(10,2) NOT NULL,
            `account_id` int(11) NOT NULL,
            `description` varchar(255) NOT NULL,
            `type_id` int(11) NOT NULL,
            `auto_book` tinyint(1) NOT NULL,
            `zpk_account_id` int(11),
            `booking_period_id` int(11),
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-scheduler-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD CONSTRAINT `payment_scheduler_template_scheduler_fkey` FOREIGN KEY (`payment_scheduler_id`) REFERENCES `payment_scheduler` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-account-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD CONSTRAINT `payment_scheduler_template_account_fkey` FOREIGN KEY (`account_id`) REFERENCES `account` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-type-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD CONSTRAINT `payment_scheduler_template_type_fkey` FOREIGN KEY (`type_id`) REFERENCES `dictionary` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-period-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD CONSTRAINT `payment_scheduler_template_period_fkey` FOREIGN KEY (`booking_period_id`) REFERENCES `booking_period` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-zpk-account-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD CONSTRAINT `payment_scheduler_template_zpk_account_fkey` FOREIGN KEY (`zpk_account_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-account-drop-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template` DROP FOREIGN KEY `payment_scheduler_template_account_fkey`;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-account-drop-column'>
        <sql>  
            ALTER TABLE `payment_scheduler_template` DROP `account_id`;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-booking-period-drop-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template` DROP FOREIGN KEY `payment_scheduler_template_period_fkey`;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-period-drop-drop-column'>
        <sql>  
            ALTER TABLE `payment_scheduler_template` DROP `booking_period_id`;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-account-column-nullable'>
        <sql>  
            ALTER TABLE `payment` MODIFY `account_id` int(11) NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-booking-period-order-column'>
        <sql> 
            ALTER TABLE `booking_period`
            ADD COLUMN `period_order` int(11) NOT NULL DEFAULT 1; 
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-scheduler-zpk-drop-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template` DROP FOREIGN KEY `payment_scheduler_template_zpk_account_fkey`;
            ALTER TABLE `payment_scheduler_template` DROP COLUMN `zpk_account_id`;
        </sql>
    </changeSet> 
    
    <changeSet author='tkopacki' id='table-payment-scheduler-zpk'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `payment_scheduler_zpk` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `payment_scheduler_id` int(11) NOT NULL,
            `zpk_account_id` int(11),
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-zpk-scheduler-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_zpk`
            ADD CONSTRAINT `payment_scheduler_zpk_scheduler_fkey` FOREIGN KEY (`payment_scheduler_id`) REFERENCES `payment_scheduler` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-zpk-zpk-account-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_zpk`
            ADD CONSTRAINT `payment_scheduler_zpk_zpk_account_fkey` FOREIGN KEY (`zpk_account_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `auto_payment` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name` varchar(255) NOT NULL,
            `active` tinyint(1) NOT NULL,
            `zpk_account_id` int(11),
            `account_id` int(11),
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-zpk-account-fkey'>
        <sql>  
            ALTER TABLE `auto_payment`
            ADD CONSTRAINT `auto_payment_zpk_account_fkey` FOREIGN KEY (`zpk_account_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-account-fkey'>
        <sql>  
            ALTER TABLE `auto_payment`
            ADD CONSTRAINT `auto_payment_account_fkey` FOREIGN KEY (`account_id`) REFERENCES `account` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-order'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `auto_payment_order` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `auto_payment_id` int(11),
            `zpk_account_id` int(11),
            `payment_order` int(11) NOT NULL DEFAULT 1,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-order-zpk-account-fkey'>
        <sql>  
            ALTER TABLE `auto_payment_order`
            ADD CONSTRAINT `auto_payment_order_zpk_account_fkey` FOREIGN KEY (`zpk_account_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-order-auto_payment-fkey'>
        <sql>  
            ALTER TABLE `auto_payment_order`
            ADD CONSTRAINT `auto_payment_order_auto_payment_fkey` FOREIGN KEY (`auto_payment_id`) REFERENCES `auto_payment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-payment'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `auto_payment_payment` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `auto_payment_id` int(11),
            `payment_id` int(11),
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-auto-payment-fkey'>
        <sql>  
            ALTER TABLE `auto_payment_payment`
            ADD CONSTRAINT `auto_payment_payment_auto_payment_fkey` FOREIGN KEY (`auto_payment_id`) REFERENCES `auto_payment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-auto-payment-payment-fkey'>
        <sql>  
            ALTER TABLE `auto_payment_payment`
            ADD CONSTRAINT `auto_payment_payment_payment_fkey` FOREIGN KEY (`payment_id`) REFERENCES `payment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-incoming-payment-document-payment'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `incoming_payment_document_payment` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `incoming_payment_document_id` int(11),
            `payment_id` int(11),
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-incoming-payment-document-payment-fkey'>
        <sql>  
            ALTER TABLE `incoming_payment_document_payment`
            ADD CONSTRAINT `incoming_payment_document_payment_fkey` FOREIGN KEY (`payment_id`) REFERENCES `payment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-incoming-payment-document-incoming-payment-fkey'>
        <sql>  
            ALTER TABLE `incoming_payment_document_payment`
            ADD CONSTRAINT `incoming_payment_document_incoming_payment_fkey` FOREIGN KEY (`incoming_payment_document_id`) REFERENCES `incoming_payment_document` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-incoming-payment-document-payment-doc-id-drop'>
        <sql>  
            ALTER TABLE `incoming_payment_document_payment` DROP FOREIGN KEY `incoming_payment_document_incoming_payment_fkey`;
        </sql>
    </changeSet> 

    <changeSet author='tkopacki' id='table-incoming-payment-document-incoming-payment-change-fkey'>
        <sql>  
            ALTER TABLE `incoming_payment_document_payment`
            ADD CONSTRAINT `incoming_payment_document_incoming_payment_fkey` FOREIGN KEY (`incoming_payment_document_id`) REFERENCES `incoming_payment_document_position` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `obligation` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name` varchar(255) NOT NULL,
            `community_id` int(11) NOT NULL,
            `contractor_zpk_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-possession-zpk'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `obligation_possession_zpk` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `obligation_id` int(11) NOT NULL,
            `possession_zpk_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-obligation-log'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `obligation_log` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `obligation_id` int(11) NOT NULL,
            `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-community-fkey'>
        <sql>  
            ALTER TABLE `obligation`
            ADD CONSTRAINT `obligation_community_fkey` FOREIGN KEY (`community_id`) REFERENCES `community` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-contractor-fkey'>
        <sql>  
            ALTER TABLE `obligation`
            ADD CONSTRAINT `obligation_contractor_fkey` FOREIGN KEY (`contractor_zpk_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-possession-obligation-fkey'>
        <sql>  
            ALTER TABLE `obligation_possession_zpk`
            ADD CONSTRAINT `obligation_possession_obligation_fkey` FOREIGN KEY (`obligation_id`) REFERENCES `obligation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-possession-zpk-fkey'>
        <sql>  
            ALTER TABLE `obligation_possession_zpk`
            ADD CONSTRAINT `obligation_possession_zpk_fkey` FOREIGN KEY (`possession_zpk_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-log-obligation-fkey'>
        <sql>  
            ALTER TABLE `obligation_log`
            ADD CONSTRAINT `obligation_log_obligation_fkey` FOREIGN KEY (`obligation_id`) REFERENCES `obligation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-contractor_id'>
        <sql>  
            ALTER TABLE `obligation` 
            ADD `contractor_id` int(11) NOT NULL
        </sql>
    </changeSet> 
    
    <changeSet author='tkopacki' id='table-obligation-contractor-id-fkey'>
        <sql>  
            ALTER TABLE `obligation`
            ADD CONSTRAINT `obligation_contractor_id_fkey` FOREIGN KEY (`contractor_id`) REFERENCES `company` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-group'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `obligation_group` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name` varchar(255) NOT NULL,
            `community_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-group-obligation'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `obligation_group_obligation` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `obligation_group_id` int(11) NOT NULL,
            `obligation_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-group-community-fkey'>
        <sql>  
            ALTER TABLE `obligation_group`
            ADD CONSTRAINT `obligation_group_community_fkey` FOREIGN KEY (`community_id`) REFERENCES `community` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-group-obligation-obligation-group-fkey'>
        <sql>  
            ALTER TABLE `obligation_group_obligation`
            ADD CONSTRAINT `obligation_group_obligation_obligation_group_fkey` FOREIGN KEY (`obligation_group_id`) REFERENCES `obligation_group` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-group-obligation-obligation-fkey'>
        <sql>  
            ALTER TABLE `obligation_group_obligation`
            ADD CONSTRAINT `obligation_group_obligation_obligation_fkey` FOREIGN KEY (`obligation_id`) REFERENCES `obligation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-possession-obligation-drop-fkey'>
        <sql>  
            ALTER TABLE `obligation_possession_zpk` DROP FOREIGN KEY `obligation_possession_obligation_fkey`
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-possession-zpk-drop-fkey'>
        <sql>  
            ALTER TABLE `obligation_possession_zpk` DROP FOREIGN KEY `obligation_possession_zpk_fkey`
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-possession-zpk-drop'>
        <sql>  
            DROP TABLE `obligation_possession_zpk`
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-group-zpk'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `obligation_group_zpk` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `obligation_group_id` int(11) NOT NULL,
            `zpk_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-group-zpk-obligation-group-fkey'>
        <sql>  
            ALTER TABLE `obligation_group_zpk`
            ADD CONSTRAINT `obligation_group_zpk_obligation_group_fkey` FOREIGN KEY (`obligation_group_id`) REFERENCES `obligation_group` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-group-zpk-zpk-fkey'>
        <sql>  
            ALTER TABLE `obligation_group_zpk`
            ADD CONSTRAINT `obligation_group_zpk_zpk_fkey` FOREIGN KEY (`zpk_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-obligation-log-excess-column'>
        <sql> 
            ALTER TABLE `obligation_log`
            ADD COLUMN `excess` decimal(10,2) DEFAULT 0; 
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-payment-community-column'>
        <sql> 
            ALTER TABLE `payment`
            ADD COLUMN `community_id` int(11) NOT NULL; 
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-community-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `payment_community_fkey` FOREIGN KEY (`community_id`) REFERENCES `community` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-company-column'>
        <sql> 
            ALTER TABLE `payment`
            ADD COLUMN `company_id` int(11);
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-company-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `payment_company_fkey` FOREIGN KEY (`company_id`) REFERENCES `company` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-possession-column'>
        <sql> 
            ALTER TABLE `payment`
            ADD COLUMN `possession_id` int(11);
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-possession-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `payment_possession_fkey` FOREIGN KEY (`possession_id`) REFERENCES `possession` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-cancel-comment-column'>
        <sql> 
            ALTER TABLE `payment`
            ADD COLUMN `cancel_comment` varchar(4096); 
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-obligation-group-id-column'>
        <sql> 
            ALTER TABLE `obligation`
            ADD COLUMN `obligation_group_id` int(11);
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-obligation-obligation-group-id-fkey'>
        <sql>  
            ALTER TABLE `obligation`
            ADD CONSTRAINT `obligation_obligation_group_id_fkey` FOREIGN KEY (`obligation_group_id`) REFERENCES `obligation_group` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-payment-company-drop-fkey'>
        <sql>  
            ALTER TABLE `payment` DROP FOREIGN KEY `payment_company_fkey`
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-company-drop'>
        <sql>  
            ALTER TABLE `payment` DROP `company_id`
        </sql>
    </changeSet>

    <changeSet author='tkopacki' id='table-payment-obligation-column'>
        <sql> 
            ALTER TABLE `payment`
            ADD COLUMN `obligation_id` int(11);
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-payment-obligation-fkey'>
        <sql>  
            ALTER TABLE `payment`
            ADD CONSTRAINT `payment_obligation_id_fkey` FOREIGN KEY (`obligation_id`) REFERENCES `obligation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-group-obligation-fkey1-drop'>
        <sql> 
            ALTER TABLE `obligation_group_obligation` DROP FOREIGN KEY `obligation_group_obligation_obligation_group_fkey`
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-group-obligation-fkey2-drop'>
        <sql> 
            ALTER TABLE `obligation_group_obligation` DROP FOREIGN KEY `obligation_group_obligation_obligation_fkey`
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-group-obligation-drop'>
        <sql>  
            DROP TABLE `obligation_group_obligation`;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-settlement-log'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `settlement_log` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `obligation_group_id` int(11) NOT NULL,
            `community_id` int(11) NOT NULL,
            `total_income` decimal(10,2) DEFAULT 0,
            `total_obligations` decimal(10,2) DEFAULT 0,
            `settlement_balance` decimal(10,2) DEFAULT 0,
            `total_area` decimal(10,2) DEFAULT 0,
            `reference_rate` decimal(10,2) DEFAULT 0,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-settlement-obligation-group-fkey'>
        <sql>  
            ALTER TABLE `settlement_log`
            ADD CONSTRAINT `settlement_obligation_group_id_fkey` FOREIGN KEY (`obligation_group_id`) REFERENCES `obligation_group` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-settlement-payment-fkey'>
        <sql>  
            ALTER TABLE `settlement_log`
            ADD CONSTRAINT `settlement_community_id_fkey` FOREIGN KEY (`community_id`) REFERENCES `community` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-settlement-log-payment'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `settlement_log_payment` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `settlement_id` int(11) NOT NULL,
            `payment_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-settlement-log-settlement-fkey'>
        <sql>  
            ALTER TABLE `settlement_log_payment`
            ADD CONSTRAINT `settlement_log_settlement_id_fkey` FOREIGN KEY (`settlement_id`) REFERENCES `settlement_log` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-settlement-log-payment-fkey'>
        <sql>  
            ALTER TABLE `settlement_log_payment`
            ADD CONSTRAINT `settlement_log_payment_id_fkey` FOREIGN KEY (`payment_id`) REFERENCES `payment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payments-type-settlement'>
        <sql>
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'SETTLEMENT', 'Rozliczenie' FROM `dictionary_type` WHERE `type` = 'PAYMENT_TYPE';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-settlement-log-timestamp-column'>
        <sql>  
            ALTER TABLE `settlement_log`
            ADD COLUMN `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-zpk-table-person-fk-drop'>
        <sql>  
            ALTER TABLE `zpk` DROP FOREIGN KEY `zbk_person_fkey`
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-zpk-table-person-column-drop'>
        <sql>  
            ALTER TABLE `zpk` DROP COLUMN `person_id`
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-zpk-table-company-fk-drop'>
        <sql>  
            ALTER TABLE `zpk` DROP FOREIGN KEY `zbk_company_fkey`
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-zpk-table-company-column-drop'>
        <sql>  
            ALTER TABLE `zpk` DROP COLUMN `company_id`
        </sql>
    </changeSet>
    
    <changeSet id="tkopacki" author="table-zpk-obligation-id-column">
        <sql>
            ALTER TABLE `zpk` ADD COLUMN `obligation_id` int(11)
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-zpk-obligation-id-fkey'>
        <sql>  
            ALTER TABLE `zpk`
            ADD CONSTRAINT `zpk_obligation_fkey` FOREIGN KEY (`obligation_id`) REFERENCES `obligation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-obligation-contractor-zpk-id-fkey-drop'>
        <sql>  
            ALTER TABLE `obligation` DROP FOREIGN KEY `obligation_contractor_fkey`
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-obligation-contractor-zpk-id-column-drop'>
        <sql>  
            ALTER TABLE `obligation` DROP COLUMN `contractor_zpk_id`
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-owner'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `owner` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `label` varchar(1024) NOT NULL,
            `address_id` int(11) NULL,
            `possession_id` int(11) NOT NULL,
            `person_id` int(11) NOT NULL,
            `company_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-owner-address-id-fkey'>
        <sql>  
            ALTER TABLE `owner`
            ADD CONSTRAINT `owner_address_fkey` FOREIGN KEY (`address_id`) REFERENCES `address` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-owner-possession-id-fkey'>
        <sql>  
            ALTER TABLE `owner`
            ADD CONSTRAINT `owner_possession_fkey` FOREIGN KEY (`possession_id`) REFERENCES `possession` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-owner-person-id-fkey'>
        <sql>  
            ALTER TABLE `owner`
            ADD CONSTRAINT `owner_person_fkey` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-owner-company-id-fkey'>
        <sql>  
            ALTER TABLE `owner`
            ADD CONSTRAINT `owner_company_fkey` FOREIGN KEY (`company_id`) REFERENCES `company` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-owner-label-column-drop'>
        <sql>  
            ALTER TABLE `owner` DROP COLUMN `label`
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-owner-possession-nullable'>
        <sql>  
            ALTER TABLE `owner` MODIFY `owner`.`possession_id` int(11)
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-owner-company-nullable'>
        <sql>  
            ALTER TABLE `owner` MODIFY `owner`.`company_id` int(11)
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-owner-person-nullable'>
        <sql>  
            ALTER TABLE `owner` MODIFY `owner`.`person_id` int(11)
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-zpk-sum'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `zpk_sum` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `zpk_id` int(11) NOT NULL,
            `booking_period_id` int(11) NULL,
            `number_prefix` varchar(10) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-zpk-sum-zpk-id-fkey'>
        <sql>  
            ALTER TABLE `zpk_sum`
            ADD CONSTRAINT `zpk_sum_zpk_fkey` FOREIGN KEY (`zpk_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-zpk-sum-booking-period-id-fkey'>
        <sql>  
            ALTER TABLE `zpk_sum`
            ADD CONSTRAINT `zpk_sum_booking_period_fkey` FOREIGN KEY (`booking_period_id`) REFERENCES `booking_period` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `report` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name` varchar(255) NOT NULL,
            `community_id` int(11) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-community-id-fkey'>
        <sql>  
            ALTER TABLE `report`
            ADD CONSTRAINT `report_community_fkey` FOREIGN KEY (`community_id`) REFERENCES `community` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-section'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `report_section` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `report_id` int(11) NOT NULL,
            `parent_id` int(11) NOT NULL,
            `query` varchar(255) NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-section-report-id-fkey'>
        <sql>  
            ALTER TABLE `report_section`
            ADD CONSTRAINT `report_section_report_fkey` FOREIGN KEY (`report_id`) REFERENCES `report` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-section-parent-id-fkey'>
        <sql>  
            ALTER TABLE `report_section`
            ADD CONSTRAINT `report_section_parent_fkey` FOREIGN KEY (`parent_id`) REFERENCES `report_section` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-attribute'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `report_attribute` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `report_id` int(11) NOT NULL,
            `attribute` varchar(255) NOT NULL,
            `attribute_alias` varchar(255) NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>    
    
    <changeSet author='tkopacki' id='table-report-attribute-report-id-fkey'>
        <sql>  
            ALTER TABLE `report_attribute`
            ADD CONSTRAINT `report_attribute_report_fkey` FOREIGN KEY (`report_id`) REFERENCES `report` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-filter'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `report_filter` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `report_id` int(11) NOT NULL,
            `table` varchar(255) NOT NULL,
            `attribute` varchar(255) NOT NULL,
            `filter_type` varchar(255) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>   
    
    <changeSet author='tkopacki' id='table-report-filter-report-id-fkey'>
        <sql>  
            ALTER TABLE `report_filter`
            ADD CONSTRAINT `report_filter_report_fkey` FOREIGN KEY (`report_id`) REFERENCES `report` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-section-parent-null'>
        <sql>  
            ALTER TABLE `report_section`
            MODIFY `parent_id` int(11) NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-section-query-text'>
        <sql>  
            ALTER TABLE `report_section`
            MODIFY `query` text NOT NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-community-id-fkey-drop'>
        <sql>  
            ALTER TABLE `report` DROP FOREIGN KEY `report_community_fkey`
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-report-community-id-column-drop'>
        <sql>  
            ALTER TABLE `report` DROP COLUMN `community_id`
        </sql>
    </changeSet>
    
    <changeSet id="tkopacki" author="table-report-attribute-order-column">
        <sql>
            ALTER TABLE `report_attribute` ADD COLUMN `attribute_order` int(11) NOT NULL DEFAULT 0
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-filter-drop-table'>
        <sql>  
            ALTER TABLE `report_filter`
            DROP COLUMN `table`
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-filter-add-entity'>
        <sql>  
            ALTER TABLE `report_filter`
            ADD COLUMN `entity` varchar(255) NOT NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-section-add-order'>
        <sql>  
            ALTER TABLE `report_section`
            ADD COLUMN `section_order` int(11) NOT NULL DEFAULT 0;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-section-add-show-header'>
        <sql>  
            ALTER TABLE `report_section`
            ADD COLUMN `show_header` boolean NOT NULL DEFAULT true;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-section-add-title'>
        <sql>  
            ALTER TABLE `report_section`
            ADD COLUMN `title` varchar(255) NULL DEFAULT '';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-section-add-show-title'>
        <sql>  
            ALTER TABLE `report_section`
            ADD COLUMN `show_title` boolean NOT NULL DEFAULT false;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-section-add-title-style'>
        <sql>  
            ALTER TABLE `report_section`
            ADD COLUMN `title_style` varchar(255) NULL DEFAULT '';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-section-add-native'>
        <sql>  
            ALTER TABLE `report_section`
            ADD COLUMN `native_query` boolean NOT NULL DEFAULT false;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-add-css'>
        <sql>  
            ALTER TABLE `report`
            ADD COLUMN `css` TEXT NULL
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-add-js'>
        <sql>  
            ALTER TABLE `report`
            ADD COLUMN `js` TEXT NULL
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-attribute-rename'>
        <sql>  
            RENAME TABLE `report_attribute` TO `report_section_attribute`
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-section-attribute-add-column-style'>
        <sql>  
            ALTER TABLE `report_section_attribute`
            ADD COLUMN `column_style` varchar(1024) NULL DEFAULT '';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-section-attribute-report-id-fkey-drop'>
        <sql>  
            ALTER TABLE `report_section_attribute` DROP FOREIGN KEY `report_attribute_report_fkey`
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-section-attribute-add-section-id'>
        <sql>  
            ALTER TABLE `report_section_attribute`
            ADD COLUMN `section_id` int(11) NOT NULL
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-section-attribute-section-id-fkey'>
        <sql>  
            ALTER TABLE `report_section_attribute`
            ADD CONSTRAINT `section_attribute_section_fkey` FOREIGN KEY (`section_id`) REFERENCES `report_section` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-report-section-add-row-style'>
        <sql>  
            ALTER TABLE `report_section`
            ADD COLUMN `row_style` varchar(1024) NULL DEFAULT '';
        </sql>
    </changeSet>
            
    <changeSet author='tkopacki' id='table-section-attribute-drop-report-id'>
        <sql>  
            ALTER TABLE `report_section_attribute`
            DROP COLUMN `report_id`
        </sql>
    </changeSet>
            
    <changeSet author='tkopacki' id='table-report-section-add-table-style'>
        <sql>  
            ALTER TABLE `report_section`
            ADD COLUMN `table_style` varchar(1024) NULL DEFAULT '';
        </sql>
    </changeSet>
            
    <changeSet author='tkopacki' id='table-report-add-oninit'>
        <sql>  
            ALTER TABLE `report`
            ADD COLUMN `on_init` varchar(1024) NULL DEFAULT '';
        </sql>
    </changeSet>
            
    <changeSet author='tkopacki' id='table-report-filter-add-group'>
        <sql>  
            ALTER TABLE `report_filter`
            ADD COLUMN `group_id` int(11) NOT NULL;
        </sql>
    </changeSet>
            
    <changeSet author='tkopacki' id='table-report-filter-add-order'>
        <sql>  
            ALTER TABLE `report_filter`
            ADD COLUMN `filter_order` int(11) NOT NULL DEFAULT '0';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-filter-group'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `report_filter_group` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `report_id` int(11) NOT NULL,
            `name` varchar(255) NOT NULL DEFAULT '',
            `group_order` int(11) NOT NULL DEFAULT 0,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-filter-group-id-fkey'>
        <sql>  
            ALTER TABLE `report_filter`
            ADD CONSTRAINT `report_filter_report_filter_group_fkey` FOREIGN KEY (`group_id`) REFERENCES `report_filter` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-report-filter-group-report-id-fkey'>
        <sql>  
            ALTER TABLE `report_filter_group`
            ADD CONSTRAINT `report_filter_group_report_fkey` FOREIGN KEY (`report_id`) REFERENCES `report` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
   
    <changeSet author='tkopacki' id='table-report-filter-group-id-fkey-drop'>
        <sql>  
            ALTER TABLE `report_filter` DROP FOREIGN KEY `report_filter_report_filter_group_fkey`
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-report-filter-group-id-fkey-2'>
        <sql>  
            ALTER TABLE `report_filter`
            ADD CONSTRAINT `report_filter_report_filter_group_fkey` FOREIGN KEY (`group_id`) REFERENCES `report_filter_group` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
                
    <changeSet author='tkopacki' id='table-payment-scheduler-template-type-column-add'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD COLUMN `calculation_type` enum('METER', 'DECLARATION') NOT NULL DEFAULT 'METER';
        </sql>
    </changeSet>
                
    <changeSet author='tkopacki' id='table-payment-scheduler-template-prefix-add'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD COLUMN `prefix` varchar(255) NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-algorithm'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `payment_algorithm` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name` varchar(255) NOT NULL,
            `algorithm` varchar(512) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-algorithm-insert'>
        <sql>  
            INSERT INTO `payment_algorithm`(name, algorithm) VALUES('m.kw.', '#{payment.income} * #{possession.area}');
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-algorithm-insert-2'>
        <sql>  
            INSERT INTO `payment_algorithm`(name, algorithm) VALUES('kwota * woda zimna * il. osob', '#{payment.income} * #{possession.coldWater} * #{possession.people}');
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-type-column-remove'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            DROP COLUMN `calculation_type`;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-payment-scheduler-template-algorithm-id-add'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD COLUMN `algorithm_id` int(11) NOT NULL DEFAULT 1
        </sql>
    </changeSet>
            
    <changeSet author='tkopacki' id='table-payment-scheduler-template-algorithm-id-fkey'>
        <sql>  
            ALTER TABLE `payment_scheduler_template`
            ADD CONSTRAINT `payment_scheduler_template_algorithm_id_fkey` FOREIGN KEY (`algorithm_id`) REFERENCES `payment_algorithm` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
            
    <changeSet author='tkopacki' id='table-possession-add-default-zpk-booking-id'>
        <sql>  
            ALTER TABLE `possession`
            ADD COLUMN `default_zpk_booking_id` int(11) NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-possession-add-account-id'>
        <sql>  
            ALTER TABLE `possession`
            ADD COLUMN `account_id` int(11) NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-possesion-auto-payment-order'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `possession_auto_payment_order` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `possession_id` int(11) NOT NULL,
            `zpk_id` int(11) NOT NULL,
            `payment_order` int(11) NOT NULL DEFAULT 1,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
                
    <changeSet author='tkopacki' id='table-possession-default-zpk-id-fkey'>
        <sql>  
            ALTER TABLE `possession`
            ADD CONSTRAINT `possesison_default_zpk_fkey` FOREIGN KEY (`default_zpk_booking_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
                
    <changeSet author='tkopacki' id='table-possession-account-id-fkey'>
        <sql>  
            ALTER TABLE `possession`
            ADD CONSTRAINT `possession_account_fkey` FOREIGN KEY (`account_id`) REFERENCES `account` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
                    
    <changeSet author='tkopacki' id='table-possession-auto-payment-possession-fkey'>
        <sql>  
            ALTER TABLE `possession_auto_payment_order`
            ADD CONSTRAINT `possession_auto_payment_possession_fkey` FOREIGN KEY (`possession_id`) REFERENCES `possession` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
                    
    <changeSet author='tkopacki' id='table-possession-auto-payment-zpk-fkey'>
        <sql>  
            ALTER TABLE `possession_auto_payment_order`
            ADD CONSTRAINT `possession_auto_payment_zpk_fkey` FOREIGN KEY (`zpk_id`) REFERENCES `zpk` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
                    
    <changeSet author='tkopacki' id='table-drop-auto-payment-payment'>
        <sql>  
            DROP TABLE `auto_payment_payment`
        </sql>
    </changeSet>
                    
    <changeSet author='tkopacki' id='table-drop-auto-payment-order'>
        <sql>  
            DROP TABLE `auto_payment_order`
        </sql>
    </changeSet>
                    
    <changeSet author='tkopacki' id='table-drop-auto-payment'>
        <sql>  
            DROP TABLE `auto_payment`
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-community-default-contractor'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `community_default_contractor` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `company_id` int(11) NOT NULL,
            `zpk_number` varchar(255) NOT NULL,
            `zpk_description` varchar(255) NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-community-default-contractor-company-id-fkey'>
        <sql>  
            ALTER TABLE `community_default_contractor`
            ADD CONSTRAINT `community_default_contractor_company_fkey` FOREIGN KEY (`company_id`) REFERENCES `company` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-algorithm-update1'>
        <sql>  
            UPDATE `payment_algorithm` SET `algorithm` = '#{scheduler.income} * #{possession.area}' WHERE `name` = 'm.kw.'
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-algorithm-update2'>
        <sql>  
            UPDATE `payment_algorithm` SET `algorithm` = '#{scheduler.income} * #{possession.coldWater} * #{possession.people}' WHERE `name` = 'kwota * woda zimna * il. osob'
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-algorithm-update3'>
        <sql>  
            UPDATE `payment_algorithm` SET `algorithm` = '#{scheduler.amount} * #{possession.area}' WHERE `name` = 'm.kw.'
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='payment-algorithm-update4'>
        <sql>  
            UPDATE `payment_algorithm` SET `algorithm` = '#{scheduler.amount} * #{possession.coldWater} * #{possession.people}' WHERE `name` = 'kwota * woda zimna * il. osob'
        </sql>
    </changeSet>
    
<!--    <changeSet id="tkopacki" author="table-report-header-style-column">
        <sql>
            ALTER TABLE `report` ADD COLUMN `header_style` varchar(1024) NULL
        </sql>
    </changeSet>-->
    
<!--    <changeSet id="tkopacki" author="table-report-section-attribute-header-style-column">
        <sql>
            ALTER TABLE `report_section_attribute` ADD COLUMN `header_style` varchar(1024) NULL
        </sql>
    </changeSet>-->
    
    <changeSet author='tkopacki' id='dictionary-elements'>
        <sql>
            INSERT INTO `dictionary_type` (`type`) VALUES
            ('ELEMENTS');
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='elements-values'>
        <sql>
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'RENT', 'Czynszowe' FROM `dictionary_type` WHERE `type` = 'ELEMENTS';
            
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'UTILITIES', 'Media' FROM `dictionary_type` WHERE `type` = 'ELEMENTS';
            
            INSERT INTO `dictionary` (`type_id`, `dictionaryKey`, `value`)
            SELECT id, 'REPAIR_FUND', 'Fundusz remontowy' FROM `dictionary_type` WHERE `type` = 'ELEMENTS';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-elements'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `element` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `group_id` int(11) NOT NULL,
            `key` varchar(255) NOT NULL,
            `name` varchar(255) NOT NULL,
            `global_value` decimal(10, 2) NOT NULL DEFAULT 0,
            PRIMARY KEY (`id`),
            UNIQUE KEY `element_key` (`key`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
                    
    <changeSet author='tkopacki' id='table-elements-group-id-fkey'>
        <sql>  
            ALTER TABLE `element`
            ADD CONSTRAINT `element_group_id_fkey` FOREIGN KEY (`group_id`) REFERENCES `dictionary` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-community-elements'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `element_community` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `element_id` int(11) NOT NULL,
            `community_id` int(11) NOT NULL,
            `value` decimal(10, 2) NOT NULL DEFAULT 0,
            `override_parent_value` boolean DEFAULT false,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
                        
    <changeSet author='tkopacki' id='table-community-elements-element-id-fkey'>
        <sql>  
            ALTER TABLE `element_community`
            ADD CONSTRAINT `element_community_element_id_fkey` FOREIGN KEY (`element_id`) REFERENCES `element` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
                        
    <changeSet author='tkopacki' id='table-community-elements-community-id-fkey'>
        <sql>  
            ALTER TABLE `element_community`
            ADD CONSTRAINT `element_community_community_id_fkey` FOREIGN KEY (`community_id`) REFERENCES `community` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
        
    <changeSet author='tkopacki' id='table-possession-elements'>
        <sql>  
            CREATE TABLE IF NOT EXISTS `element_possession` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `element_id` int(11) NOT NULL,
            `possession_id` int(11) NOT NULL,
            `value` decimal(10, 2) NOT NULL DEFAULT 0,
            `override_parent_value` boolean DEFAULT false,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
                        
    <changeSet author='tkopacki' id='table-possession-elements-element-id-fkey'>
        <sql>  
            ALTER TABLE `element_possession`
            ADD CONSTRAINT `element_possession_element_id_fkey` FOREIGN KEY (`element_id`) REFERENCES `element` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
                        
    <changeSet author='tkopacki' id='table-possession-elements-possession-id-fkey'>
        <sql>  
            ALTER TABLE `element_possession`
            ADD CONSTRAINT `element_possession_possession_id_fkey` FOREIGN KEY (`possession_id`) REFERENCES `possession` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
    
     <changeSet author='tkopacki' id='table-elements-key-column-rename'>
        <sql>  
            ALTER TABLE `element` CHANGE `key` `key_value` varchar(255);
        </sql>
    </changeSet>
    
     <changeSet author='tkopacki' id='table-elements-add-column-default'>
        <sql>  
            ALTER TABLE `element` ADD COLUMN `default_element` boolean NOT NULL DEFAULT true;
        </sql>
    </changeSet>
    
     <changeSet author='tkopacki' id='table-elements-add-column-algorithm'>
        <sql>  
            ALTER TABLE `element` ADD COLUMN `algorithm` varchar(1024);
        </sql>
    </changeSet>
    
     <changeSet author='tkopacki' id='table-elements-possession-add-column-community-element'>
        <sql>  
            ALTER TABLE `element_possession` ADD COLUMN `element_community_id` int(11) NOT NULL;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='table-possession-elements-element-community-id-fkey'>
        <sql>  
            ALTER TABLE `element_possession`
            ADD CONSTRAINT `element_possession_element_community_id_fkey` FOREIGN KEY (`element_community_id`) REFERENCES `element_community` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;            
        </sql>
    </changeSet>
</databaseChangeLog>
