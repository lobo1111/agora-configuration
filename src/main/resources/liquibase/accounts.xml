<?xml version="1.0" encoding="UTF-8"?> 
<databaseChangeLog 
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd"> 
    <changeSet author='tkopacki' id='bank-table'>
        <sql> 
            CREATE TABLE IF NOT EXISTS `bank` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `name` varchar(150) COLLATE utf8_polish_ci NOT NULL,
            PRIMARY KEY (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='account-add-bank-column'>
        <sql>  
            ALTER TABLE `account` 
            ADD `bank_id` int(11) NOT NULL
        </sql>
    </changeSet>  
    
    <changeSet author='tkopacki' id='account-bank-fkey'>
        <sql> 
            ALTER TABLE `account`
            ADD CONSTRAINT `bank_id_fkey` FOREIGN KEY (`bank_id`) REFERENCES `bank` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='bank-add-key-column'>
        <sql>  
            ALTER TABLE `bank` 
            ADD `bankKey` varchar(150) NOT NULL
        </sql>
    </changeSet> 
    
    <changeSet author='tkopacki' id='bank-pocztowy-insert'>
        <sql> 
            INSERT INTO `bank` (`name`, `bankKey`) VALUES ('Bank Pocztowy', 'BANK_POCZTOWY');
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='bank-pocztowy-account-insert'>
        <sql> 
            INSERT INTO `account` (`bank_id`, `name`, `number`)
            SELECT id, 'Bank Pocztowy - konto główne', '321421343214324' FROM `bank` WHERE `key` = 'BANK_POCZTOWY'
        </sql>
    </changeSet>
</databaseChangeLog>