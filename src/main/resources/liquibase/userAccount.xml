<?xml version="1.0" encoding="UTF-8"?> 
<databaseChangeLog 
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd"> 
    <changeSet author='tkopacki' id='user-group-table'>
        <sql>
            CREATE TABLE IF NOT EXISTS `user_group` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `user` varchar(45) COLLATE utf8_polish_ci NOT NULL,
            `name` varchar(45) COLLATE utf8_polish_ci NOT NULL,
            PRIMARY KEY (`id`),
            KEY `group_user_fkey` (`user`)
            ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    <changeSet author='tkopacki' id='user-table'>
        <sql>         
            CREATE TABLE IF NOT EXISTS `user` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `login` varchar(45) COLLATE utf8_polish_ci NOT NULL,
            `password` varchar(150) COLLATE utf8_polish_ci NOT NULL,
            `person_id` int(11) NOT NULL,
            PRIMARY KEY (`id`),
            UNIQUE KEY `login_UNIQUE` (`login`),
            KEY `user_person_fkey` (`person_id`)
            ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    <changeSet author='tkopacki' id='user-person-fkey'>
        <sql>    
            ALTER TABLE `user`
            ADD CONSTRAINT `user_person_fkey` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    <changeSet author='tkopacki' id='user-group-fkey'>
        <sql>    
            ALTER TABLE `user_group`
            ADD CONSTRAINT `group_user_fkey` FOREIGN KEY (`user`) REFERENCES `user` (`login`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    <changeSet author='tkopacki' id='admin-user-insert'>
        <sql>    
            INSERT INTO `address` (`id`, `street`, `house_number`, `flat_number`, `postal_code`, `city`) VALUES
            (1, 'Krynicka', '43', '10', '50555', 'Wroc≈Çaw');
            
            INSERT INTO `person` (`id`, `first_name`, `last_name`, `pesel`, `phone_number_1`, `phone_number_2`, `phone_number_3`, `email`, `address_id`) VALUES
            (1, 'Tomasz', 'Kopacki', '86041405116', '664 007 904', NULL, NULL, 'tomasz@kopacki.eu', 1);
            
            INSERT INTO `user` (`id`, `login`, `password`, `person_id`) VALUES
            (1, 'lobo', '3e30da3972953c020ac40149f6ef4d25d1c28c8b9ea58e68bdd236716cdc932e', 1);
            
            INSERT INTO `user_group` (`id`, `user`, `name`) VALUES
            (1, 'lobo', 'administrators');
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='admin-user-insert'>
        <sql>   
            INSERT INTO `user_group` (`id`, `user`, `name`) VALUES
            (1, 'lobo', 'all');
        </sql>
    </changeSet>
</databaseChangeLog> 