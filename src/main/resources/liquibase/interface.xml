<?xml version="1.0" encoding="UTF-8"?> 
<databaseChangeLog 
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd"> 
    <changeSet author='tkopacki' id='interface-category-table'>
        <sql>
            CREATE TABLE IF NOT EXISTS `category` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `category_key` varchar(45) COLLATE utf8_polish_ci NOT NULL,
            `name` varchar(45) COLLATE utf8_polish_ci NOT NULL,
            `category_order` int(11) NOT NULL DEFAULT '100',
            PRIMARY KEY (`id`),
            UNIQUE KEY `name_UNIQUE` (`category_key`)
            ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    <changeSet author='tkopacki' id='interface-category-item-table'>
        <sql>
            CREATE TABLE IF NOT EXISTS `category_item` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `category_id` int(11) NOT NULL,
            `item_key` varchar(45) COLLATE utf8_polish_ci NOT NULL,
            `name` varchar(45) COLLATE utf8_polish_ci NOT NULL,
            `item_order` int(11) NOT NULL DEFAULT '100',
            PRIMARY KEY (`id`),
            UNIQUE KEY `name_UNIQUE` (`item_key`)
            ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci AUTO_INCREMENT=1 ;
        </sql>
    </changeSet>
    <changeSet author='tkopacki' id='interface-category-item-fkey'>
        <sql> 
            ALTER TABLE `category_item`
            ADD CONSTRAINT `category_item_fkey` FOREIGN KEY (`category_id`) REFERENCES `category` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='interface-categories-insert-1'>
        <sql> 
            INSERT INTO `category`(category_key, name, `category_order`) VALUES('INCOMING_DOCUMENTS', 'Przelewy przychodzące', 100);
            INSERT INTO `category`(category_key, name, `category_order`) VALUES('COMMUNITES_AND_POSSESSIONS', 'Wspólnoty i mieszkania', 200);
            INSERT INTO `category`(category_key, name, `category_order`) VALUES('OWNERS', 'Właściciele prywatni i firmy', 300);
            INSERT INTO `category`(category_key, name, `category_order`) VALUES('SYNC', 'Synchronizacja', 400);
            INSERT INTO `category`(category_key, name, `category_order`) VALUES('SETTINGS', 'Ustawienia', 500);
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='interface-category-items-incoming-documents'>
        <sql>
            INSERT INTO `category_item` (`category_id`, `item_key`, `name`, `item_order`)
            SELECT id, 'BP', 'Bank Pocztowy', 100 FROM `category` WHERE `category_key` = 'INCOMING_DOCUMENTS'; 
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='interface-category-items-communities-possessions'>
        <sql>
            INSERT INTO `category_item` (`category_id`, `item_key`, `name`, `item_order`)
            SELECT id, 'COMMUNITES', 'Wspólnoty', 100 FROM `category` WHERE `category_key` = 'COMMUNITES_AND_POSSESSIONS'; 
            INSERT INTO `category_item` (`category_id`, `item_key`, `name`, `item_order`)
            SELECT id, 'POSSESSIONS', 'Mieszkania', 100 FROM `category` WHERE `category_key` = 'COMMUNITES_AND_POSSESSIONS';
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='interface-category-items-owners'>
        <sql>
            INSERT INTO `category_item` (`category_id`, `item_key`, `name`, `item_order`)
            SELECT id, 'PEOPLE', 'Osoby fizyczne', 100 FROM `category` WHERE `category_key` = 'OWNERS'; 
            INSERT INTO `category_item` (`category_id`, `item_key`, `name`, `item_order`)
            SELECT id, 'COMPANIES', 'Firmy', 200 FROM `category` WHERE `category_key` = 'OWNERS'; 
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='interface-category-items-sync'>
        <sql>
            INSERT INTO `category_item` (`category_id`, `item_key`, `name`, `item_order`)
            SELECT id, 'SYNC_ALL', 'Synchronizuj ze starą bazą', 100 FROM `category` WHERE `category_key` = 'SYNC'; 
        </sql>
    </changeSet>
    
    <changeSet author='tkopacki' id='interface-category-items-settings'>
        <sql>
            INSERT INTO `category_item` (`category_id`, `item_key`, `name`, `item_order`)
            SELECT id, 'CRON', 'Zadania cykliczne', 100 FROM `category` WHERE `category_key` = 'SETTINGS'; 
            INSERT INTO `category_item` (`category_id`, `item_key`, `name`, `item_order`)
            SELECT id, 'SCRIPTS', 'Skrypty', 100 FROM `category` WHERE `category_key` = 'SETTINGS'; 
            INSERT INTO `category_item` (`category_id`, `item_key`, `name`, `item_order`)
            SELECT id, 'TEMPLATES', 'Szablony', 100 FROM `category` WHERE `category_key` = 'SETTINGS'; 
            INSERT INTO `category_item` (`category_id`, `item_key`, `name`, `item_order`)
            SELECT id, 'CATEGORIES', 'Kategorie', 100 FROM `category` WHERE `category_key` = 'SETTINGS'; 
        </sql>
    </changeSet>
    
</databaseChangeLog>