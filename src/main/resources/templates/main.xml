<?xml version="1.0" encoding="UTF-8"?>
<templates>
    <!-- ENTITIES -->
    <template>
        <name>entity-settlement</name>
        <source>entity-settlement.vtl</source>
        <variables>
            <var>
                <name>obligationGroup</name>
                <data>
                    {:single}
                    SELECT
                    og
                    FROM
                    ObligationGroup og
                    WHERE
                    og.id = {:id}
                </data>
            </var>
            <var>
                <name>possessions</name>
                <data>
                    SELECT
                    zpk
                    FROM
                    ObligationGroup og
                    JOIN og.zpks zpk
                    JOIN zpk.zpkBalances balance
                    JOIN balance.bookingPeriod period
                    WHERE
                    period.defaultPeriod = true
                    AND og.id = {:id}
                </data>
            </var>
            <var>
                <name>obligations</name>
                <data>
                    SELECT
                    obligation
                    FROM
                    Obligation obligation
                    JOIN obligation.obligationGroup og
                    JOIN obligation.zpk zpk
                    JOIN zpk.zpkBalances balance
                    JOIN balance.bookingPeriod period
                    WHERE
                    period.defaultPeriod = true
                    AND og.id = {:id}
                </data>
            </var>
            <var>
                <name>logs</name>
                <data>
                    SELECT
                    log
                    FROM
                    SettlementLog log
                    JOIN log.obligationGroup og
                    WHERE
                    og.id = {:id}
                    ORDER BY log.timestamp DESC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-report</name>
        <source>entity-report.vtl</source>
        <variables>
            <var>
                <name>report</name>
                <data>
                    {:single}
                    SELECT 
                    report
                    FROM 
                    Report report
                    WHERE 
                    report.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-element</name>
        <source>entity-element.vtl</source>
        <variables>
            <var>
                <name>entity</name>
                <data>
                    {:single}
                    SELECT 
                    e
                    FROM 
                    Element e
                    WHERE 
                    e.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-community-default-contractor</name>
        <source>entity-community-default-contractor.vtl</source>
        <variables>
            <var>
                <name>entity</name>
                <data>
                    {:single}
                    SELECT 
                    a
                    FROM 
                    CommunityDefaultContractor a
                    WHERE 
                    a.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-default-booking-period</name>
        <source>entity-default-booking-period.vtl</source>
        <variables>
            <var>
                <name>period</name>
                <data>
                    {:single}
                    SELECT 
                    period
                    FROM 
                    BookingPeriod period
                    WHERE 
                    period.defaultPeriod = true
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-owner</name>
        <source>entity-owner.vtl</source>
        <variables>
            <var>
                <name>owner</name>
                <data>
                    {:single}
                    SELECT 
                    owner
                    FROM 
                    Owner owner
                    WHERE 
                    owner.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-obligation</name>
        <source>entity-obligation.vtl</source>
        <variables>
            <var>
                <name>obligation</name>
                <data>
                    {:single}
                    SELECT 
                    o
                    FROM 
                    Obligation o
                    WHERE 
                    o.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-obligation-group</name>
        <source>entity-obligation-group.vtl</source>
        <variables>
            <var>
                <name>row</name>
                <data>
                    {:single}
                    SELECT 
                    o
                    FROM 
                    ObligationGroup o
                    WHERE 
                    o.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-payment-scheduler</name>
        <source>entity-payment-scheduler.vtl</source>
        <variables>
            <var>
                <name>ps</name>
                <data>
                    {:single}
                    SELECT 
                    ps
                    FROM 
                    PaymentScheduler ps
                    WHERE 
                    ps.id = {:id}
                </data>
            </var>
            <var>
                <name>free</name>
                <data>
                    SELECT 
                    free
                    FROM 
                    PaymentScheduler ps
                    JOIN ps.community c
                    JOIN c.zpks free
                    WHERE 
                    ps.id = {:id}
                    AND free.id NOT IN(
                    SELECT 
                    bounded.id
                    FROM 
                    ps.zpks bounded)
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-zpk</name>
        <source>entity-zpk.vtl</source>
        <variables>
            <var>
                <name>zpk</name>
                <data>
                    {:single}
                    SELECT 
                    zpk
                    FROM 
                    ZakladowyPlanKont zpk
                    JOIN zpk.zpkBalances balance
                    JOIN balance.bookingPeriod period
                    WHERE 
                    zpk.id = {:id}
                    AND period.id = {:bookingPeriod}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-zpk-sum</name>
        <source>entity-zpk-sum.vtl</source>
        <variables>
            <var>
                <name>zpk</name>
                <data>
                    {:single}
                    SELECT
                    zpk.number,
                    zpk.description,
                    SUM(balance.credit),
                    SUM(balance.debit),
                    community.id,
                    community.name
                    FROM
                    ZakladowyPlanKont zpk
                    JOIN zpk.zpkSums zpkSum
                    JOIN zpkSum.bookingPeriod basePeriod
                    JOIN zpk.community community
                    JOIN community.zpks zpkToCount
                    JOIN zpkToCount.zpkBalances balance
                    JOIN balance.bookingPeriod bookingPeriod
                    WHERE
                    zpk.id = {:id}
                    AND bookingPeriod.defaultPeriod = true
                    AND basePeriod.defaultPeriod = true
                    AND zpkToCount.number LIKE CONCAT(zpkSum.numberPrefix, \'%\')
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-community</name>
        <source>entity-community.vtl</source>
        <variables>
            <var>
                <name>community</name>
                <data>
                    {:single}
                    SELECT c FROM Community c WHERE c.id = {:id}
                </data>
            </var>
        </variables>
    </template>    
    <template>
        <name>entity-possession</name>
        <source>entity-possession.vtl</source>
        <variables>
            <var>
                <name>possession</name>
                <data>
                    {:single}
                    SELECT c FROM Possession c WHERE c.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-account</name>
        <source>entity-account.vtl</source>
        <variables>
            <var>
                <name>account</name>
                <data>
                    {:single}
                    SELECT c FROM Account c WHERE c.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-bank</name>
        <source>entity-bank.vtl</source>
        <variables>
            <var>
                <name>bank</name>
                <data>
                    {:single}
                    SELECT c FROM Bank c WHERE c.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-person</name>
        <source>entity-person.vtl</source>
        <variables>
            <var>
                <name>person</name>
                <data>
                    {:single}
                    SELECT 
                    p
                    FROM 
                    Person p
                    WHERE
                    p.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>entity-company</name>
        <source>entity-company.vtl</source>
        <variables>
            <var>
                <name>company</name>
                <data>
                    {:single}
                    SELECT 
                    p
                    FROM 
                    Company p
                    WHERE
                    p.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <!-- LISTS -->
    <template>
        <name>list-community-charging</name>
        <source>list-community-charging.vtl</source>
        <variables>
            <var>
                <name>items</name>
                <data>
                    SELECT
                        community,
                        COUNT(possession.id) as counter
                    FROM
                        Community community
                        JOIN community.possessions possession
                    WHERE
                        possession.id NOT IN(
                            SELECT 
                                charged.id 
                            FROM 
                                Charging charging
                                JOIN charging.possession charged
                            WHERE
                                charging.month IN(
                                    SELECT
                                        dict.value
                                    FROM
                                        Dictionary dict
                                        JOIN dict.type dtype
                                    WHERE
                                        dtype.type = "PERIODS"
                                        AND dict.key = "CURRENT"))
                    GROUP BY
                        community.id
                    HAVING
                        counter > 0
                    ORDER BY
                        community.name ASC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-settlements</name>
        <source>list-settlements.vtl</source>
        <variables>
            <var>
                <name>settlements</name>
                <data>
                    {:native}
                    {:limit}
                    SELECT
                    og.id,
                    og.name,
                    c.name,
                    sum1.c,
                    sum1.d,
                    sum2.oc,
                    sum2.od
                    FROM
                    obligation_group AS og
                    JOIN community AS c ON(og.community_id = c.id)
                    JOIN 
                    (SELECT
                    og.id AS id,
                    og.name,
                    SUM(zb.credit) AS c,
                    SUM(zb.debit) AS d
                    FROM
                    obligation_group AS og
                    JOIN obligation_group_zpk AS ogz ON(og.id = ogz.obligation_group_id)
                    JOIN zpk AS z ON(z.id = ogz.zpk_id)
                    JOIN zpk_balance AS zb ON(z.id = zb.zpk_id)
                    JOIN booking_period AS bp ON(zb.booking_period_id = bp.id)
                    WHERE
                    bp.default_period = 1
                    GROUP BY 
                    og.id, og.name) AS sum1 ON(og.id = sum1.id)
                    JOIN
                    (SELECT
                    og.id AS id,
                    og.name,
                    SUM(zb.credit) AS oc,
                    SUM(zb.debit) AS od
                    FROM
                    obligation_group AS og
                    JOIN obligation AS o ON(o.obligation_group_id = og.id)
                    JOIN zpk AS z ON(z.obligation_id = o.id)
                    JOIN zpk_balance AS zb ON(z.id = zb.zpk_id)
                    JOIN booking_period AS bp ON(zb.booking_period_id = bp.id)
                    WHERE
                    bp.default_period = 1
                    GROUP BY 
                    og.id, og.name) AS sum2 ON(og.id = sum2.id)
                    WHERE {:where}
                    ORDER BY c.name, og.name ASC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:native}
                    {:single}
                    SELECT
                    count(og.id)
                    FROM
                    obligation_group AS og
                    JOIN community AS c ON(og.community_id = c.id)
                    JOIN 
                    (SELECT
                    og.id AS id,
                    og.name,
                    SUM(zb.credit) AS c,
                    SUM(zb.debit) AS d
                    FROM
                    obligation_group AS og
                    JOIN obligation_group_zpk AS ogz ON(og.id = ogz.obligation_group_id)
                    JOIN zpk AS z ON(z.id = ogz.zpk_id)
                    JOIN zpk_balance AS zb ON(z.id = zb.zpk_id)
                    JOIN booking_period AS bp ON(zb.booking_period_id = bp.id)
                    WHERE
                    bp.default_period = 1
                    GROUP BY 
                    og.id, og.name) AS sum1 ON(og.id = sum1.id)
                    JOIN
                    (SELECT
                    og.id AS id,
                    og.name,
                    SUM(zb.credit) AS oc,
                    SUM(zb.debit) AS od
                    FROM
                    obligation_group AS og
                    JOIN obligation AS o ON(o.obligation_group_id = og.id)
                    JOIN zpk AS z ON(z.obligation_id = o.id)
                    JOIN zpk_balance AS zb ON(z.id = zb.zpk_id)
                    JOIN booking_period AS bp ON(zb.booking_period_id = bp.id)
                    WHERE
                    bp.default_period = 1
                    GROUP BY 
                    og.id, og.name) AS sum2 ON(og.id = sum2.id)
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-payments-scheduler</name>
        <source>list-payments-scheduler.vtl</source>
        <variables>
            <var>
                <name>schedulers</name>
                <data>
                    {:limit}
                    SELECT
                    paymentScheduler
                    FROM
                    PaymentScheduler paymentScheduler
                    JOIN paymentScheduler.paymentSchedulerTemplates template
                    JOIN paymentScheduler.community community
                    WHERE {:where}
                    ORDER BY
                    paymentScheduler.name ASC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT
                    count(paymentScheduler.id)
                    FROM
                    PaymentScheduler paymentScheduler
                    JOIN paymentScheduler.paymentSchedulerTemplates template
                    JOIN paymentScheduler.community community
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-obligations</name>
        <source>list-obligations.vtl</source>
        <variables>
            <var>
                <name>obligations</name>
                <data>
                    {:limit}
                    SELECT
                    obligation
                    FROM
                    Obligation obligation
                    JOIN obligation.contractor company
                    JOIN obligation.community community
                    LEFT OUTER JOIN obligation.obligationGroup obligationGroup
                    WHERE {:where}
                    ORDER BY
                    community.name, obligation.name ASC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT
                    count(obligation.id)
                    FROM
                    Obligation obligation
                    JOIN obligation.contractor company
                    LEFT OUTER JOIN obligation.obligationGroup obligationGroup
                    JOIN obligation.community community
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-obligations-groups</name>
        <source>list-obligations-groups.vtl</source>
        <variables>
            <var>
                <name>groups</name>
                <data>
                    {:limit}
                    SELECT
                    og
                    FROM
                    ObligationGroup og
                    JOIN og.community community
                    WHERE {:where}
                    ORDER BY
                    community.name, og.name ASC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT
                    count(og.id)
                    FROM
                    ObligationGroup og
                    JOIN og.community community
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-community-default-contractors</name>
        <source>list-community-default-contractors.vtl</source>
        <variables>
            <var>
                <name>contractors</name>
                <data>
                    {:limit}
                    SELECT
                    c
                    FROM
                    CommunityDefaultContractor c
                    JOIN c.company company
                    WHERE {:where}
                    ORDER BY
                    company.name ASC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT
                    count(c.id)
                    FROM
                    CommunityDefaultContractor c
                    JOIN c.company company
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-zpks</name>
        <source>list-zpks.vtl</source>
        <variables>
            <var>
                <name>zpks</name>
                <data>
                    {:limit}
                    SELECT
                    zpk
                    FROM
                    ZakladowyPlanKont zpk
                    JOIN zpk.community community
                    JOIN zpk.zpkBalances balance
                    JOIN balance.bookingPeriod period
                    LEFT OUTER JOIN zpk.possession possession
                    LEFT OUTER JOIN zpk.obligation obligation
                    WHERE {:where} AND
                    period.defaultPeriod = true
                    ORDER BY
                    community.name, zpk.number ASC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT
                    count(zpk.id)
                    FROM
                    ZakladowyPlanKont zpk
                    JOIN zpk.community community
                    JOIN zpk.zpkBalances balance
                    JOIN balance.bookingPeriod period
                    LEFT OUTER JOIN zpk.possession possession
                    LEFT OUTER JOIN zpk.obligation obligation
                    WHERE {:where} AND
                    period.defaultPeriod = true
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-communities</name>
        <source>list-communities.vtl</source>
        <variables>
            <var>
                <name>communities</name>
                <data>
                    {:limit}
                    SELECT
                    community
                    FROM
                    Community community
                    WHERE {:where}
                    ORDER BY community.name ASC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT
                    count(community.id)
                    FROM
                    Community community
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-possessions</name>
        <source>list-possessions.vtl</source>
        <variables>
            <var>
                <name>possessions</name>
                <data>
                    {:limit}
                    SELECT 
                    possession
                    FROM 
                    Possession possession
                    JOIN possession.address possessionAddress
                    JOIN possession.community community
                    WHERE {:where}
                    ORDER BY 
                    community.name, 
                    possessionAddress.street, 
                    possessionAddress.houseNumber, 
                    possessionAddress.flatNumber ASC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT 
                    count(possession.id)
                    FROM 
                    Possession possession
                    JOIN possession.address possessionAddress
                    JOIN possession.community community
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-banks</name>
        <source>list-banks.vtl</source>
        <variables>
            <var>
                <name>banks</name>
                <data>
                    {:limit}
                    SELECT 
                    bank
                    FROM 
                    Bank bank
                    WHERE {:where}
                    ORDER BY bank.name
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT 
                    count(bank.id)
                    FROM 
                    Bank bank
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-accounts</name>
        <source>list-accounts.vtl</source>
        <variables>
            <var>
                <name>accounts</name>
                <data>
                    {:limit}
                    SELECT 
                    account
                    FROM 
                    Account account
                    JOIN account.type accountType
                    JOIN account.bank bank
                    LEFT OUTER JOIN account.parrentAccount parentAccount
                    WHERE {:where}
                    ORDER BY account.name ASC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT 
                    count(account.id)
                    FROM 
                    Account account
                    JOIN account.type accountType
                    JOIN account.bank bank
                    JOIN account.parrentAccount parentAccount
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-incoming-documents</name>
        <source>list-incoming-documents.vtl</source>
        <variables>
            <var>
                <name>documents</name>
                <data>
                    {:limit}
                    SELECT 
                    document
                    FROM 
                    IncomingPaymentDocumentPosition document
                    JOIN document.status status
                    JOIN document.document parentDocument
                    WHERE {:where}
                    ORDER BY document.requestDate DESC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT 
                    count(document.id)
                    FROM 
                    IncomingPaymentDocumentPosition document
                    JOIN document.status status
                    JOIN document.document parentDocument
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-elements</name>
        <source>list-elements.vtl</source>
        <variables>
            <var>
                <name>items</name>
                <data>
                    {:limit}
                    SELECT 
                    element
                    FROM 
                    Element element
                    JOIN element.group elGroup
                    WHERE {:where}
                    ORDER BY element.key ASC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT 
                    count(element.id)
                    FROM 
                    Element element
                    JOIN element.group elGroup
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-chargings</name>
        <source>list-chargings.vtl</source>
        <variables>
            <var>
                <name>items</name>
                <data>
                    {:limit}
                    SELECT 
                    charging,
                    SUM(chargingElements.value)
                    FROM 
                    Charging charging
                    JOIN charging.chargingElements chargingElements
                    JOIN charging.bookingPeriod bookingPeriod
                    JOIN charging.possession possession
                    JOIN possession.address possessionAddress
                    JOIN possession.community community
                    WHERE {:where}
                    GROUP BY chargingElements.charging
                    ORDER BY charging.timestamp DESC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    {:native}
                    SELECT count(*)
                    FROM (
                        SELECT DISTINCT c.id
                        FROM charging AS c
                        JOIN charging_element AS ce ON (c.id = ce.charging_id)
                        JOIN possession AS possession ON (possession.id = c.possession_id)
                        JOIN address AS possessionAddress ON(possessionAddress.id = possession.address_id)
                        JOIN booking_period AS bp ON(bp.id = c.booking_period_id)
                        JOIN community AS community ON (community.id = possession.community_id)
                        WHERE {:where}
                    ) AS tmp
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-charging-elements</name>
        <source>list-charging-elements.vtl</source>
        <variables>
            <var>
                <name>items</name>
                <data>
                    {:limit}
                    SELECT 
                    element
                    FROM 
                    ChargingElement element
                    JOIN element.charging charging
                    WHERE charging.id = {:where}
                    ORDER BY element.key ASC
                </data>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT 
                    COUNT(element.id)
                    FROM 
                    ChargingElement element
                    JOIN element.charging charging
                    WHERE charging.id = {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-payments</name>
        <source>list-payments.vtl</source>
        <variables>
            <var>
                <name>payments</name>
                <data>
                    {:limit}
                    SELECT 
                    payment
                    FROM 
                    Payment payment
                    JOIN payment.status paymentStatus
                    JOIN payment.type paymentType
                    LEFT OUTER JOIN payment.account account
                    LEFT OUTER JOIN account.bank bank
                    LEFT OUTER JOIN payment.zpkBalance balance
                    LEFT OUTER JOIN balance.bookingPeriod period
                    LEFT OUTER JOIN balance.zpk zpk
                    LEFT OUTER JOIN zpk.community community
                    LEFT OUTER JOIN zpk.possession possession
                    LEFT OUTER JOIN zpk.obligation obligation
                    LEFT OUTER JOIN payment.documents doc
                    WHERE {:where}
                    ORDER BY payment.createDay DESC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT 
                    count(payment.id)
                    FROM 
                    Payment payment
                    JOIN payment.status paymentStatus
                    JOIN payment.type paymentType
                    LEFT OUTER JOIN payment.account account
                    LEFT OUTER JOIN account.bank bank
                    LEFT OUTER JOIN payment.zpkBalance balance
                    LEFT OUTER JOIN balance.bookingPeriod period
                    LEFT OUTER JOIN balance.zpk zpk
                    LEFT OUTER JOIN zpk.community community
                    LEFT OUTER JOIN zpk.possession possession
                    LEFT OUTER JOIN zpk.obligation obligation
                    LEFT OUTER JOIN payment.documents doc
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-owners</name>
        <source>list-owners.vtl</source>
        <variables>
            <var>
                <name>owners</name>
                <data>
                    {:limit}
                    SELECT
                    owner
                    FROM 
                    Owner owner
                    LEFT OUTER JOIN owner.company company
                    LEFT OUTER JOIN owner.person person
                    JOIN owner.possession possession
                    JOIN possession.community community
                    WHERE {:where}
                    ORDER BY company.name, person.lastName ASC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT count(owner.id)
                    FROM
                    Owner owner
                    LEFT OUTER JOIN owner.company company
                    LEFT OUTER JOIN owner.person person
                    JOIN owner.possession possession
                    JOIN possession.community community
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-companies</name>
        <source>list-companies.vtl</source>
        <variables>
            <var>
                <name>companies</name>
                <data>
                    {:limit}
                    SELECT
                    company
                    FROM 
                    Company company
                    JOIN company.address address
                    LEFT OUTER JOIN company.obligations obligation
                    LEFT OUTER JOIN company.owners owner
                    LEFT OUTER JOIN owner.possession possession
                    WHERE {:where}
                    ORDER BY company.name ASC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT count(company.id)
                    FROM
                    Company company
                    JOIN company.address address
                    LEFT OUTER JOIN company.obligations obligation
                    LEFT OUTER JOIN company.owners owner
                    LEFT OUTER JOIN owner.possession possession
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-people</name>
        <source>list-people.vtl</source>
        <variables>
            <var>
                <name>people</name>
                <data>
                    {:limit}
                    SELECT
                    person
                    FROM 
                    Person person
                    JOIN person.address personAddress
                    WHERE {:where}
                    ORDER BY person.lastName, person.firstName ASC
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT count(person.id)
                    FROM
                    Person person
                    JOIN person.address personAddress
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
    
    <template>
        <name>list-report-filters</name>
        <source>list-report-filters.vtl</source>
        <variables>
            <var>
                <name>filters</name>
                <data>
                    SELECT 
                        filter
                    FROM
                        ReportFilter filter
                        JOIN filter.report report
                        JOIN filter.group filterGroup
                    WHERE
                        {:where}
                    ORDER BY
                        filterGroup.groupOrder, filter.filterOrder ASC
                </data>
            </var>
        </variables>
    </template>
    <!-- ################### SIMPLE LISTS ########################## -->
    
    <template>
        <name>list-booking-periods</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    period.id, 
                    period.name) 
                    FROM
                    BookingPeriod period
                    ORDER BY
                    period.name DESC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-booking-periods-active</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    period.id, 
                    period.name) 
                    FROM
                    BookingPeriod period
                    WHERE
                    period.active = true
                    ORDER BY
                    period.name DESC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-possession-zpks</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    zpk.id, 
                    zpk.number) 
                    FROM
                    Possession possession
                    JOIN possession.zpks zpk
                    WHERE
                    possession.id = {:id}
                    ORDER BY zpk.number ASC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>list-community-zpks</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    zpk.id, 
                    CONCAT(zpk.number, " - ", zpk.description))
                    FROM
                    Community community
                    JOIN community.zpks zpk
                    WHERE
                    community.id = {:id}
                    ORDER BY zpk.number ASC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>simple-list-elements-types</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    dic.id, dic.value)
                    FROM 
                    Dictionary dic
                    WHERE 
                    dic.type.type = \'ELEMENTS\'
                    ORDER BY 
                    dic.value ASC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>simple-list-payments-types</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    dic.id, dic.value)
                    FROM 
                    Dictionary dic
                    WHERE 
                    dic.type.type = \'PAYMENT_TYPE\'
                    AND dic.key != \'AUTO\'
                    ORDER BY 
                    dic.value ASC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>simple-list-payments-statuses</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    dic.id, dic.value)
                    FROM 
                    Dictionary dic
                    WHERE 
                    dic.type.type = \'PAYMENT_STATUS\'
                    ORDER BY 
                    dic.value ASC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>simple-list-documents-statuses</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    dic.id, dic.value)
                    FROM 
                    Dictionary dic
                    WHERE 
                    dic.type.type = \'DOCUMENT_STATUS\'
                    ORDER BY 
                    dic.value ASC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>simple-list-payment-algorithms</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    pa.id, pa.name)
                    FROM 
                    PaymentAlgorithm pa
                    ORDER BY 
                    pa.name ASC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>simple-list-accounts-types</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    dic.id, dic.value)
                    FROM 
                    Dictionary dic
                    WHERE 
                    dic.type.type = \'ACCOUNT_TYPE\'
                    ORDER BY 
                    dic.value ASC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>simple-list-banks-names</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    bank.id, bank.name)
                    FROM 
                    Bank bank
                    ORDER BY 
                    bank.name ASC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>simple-list-communities-names</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    community.id, community.name)
                    FROM 
                    Community community 
                    ORDER BY 
                    community.name ASC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>simple-list-communities-obligations</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    obligation.id, obligation.name)
                    FROM 
                    Obligation obligation 
                    LEFT OUTER JOIN obligation.obligationGroup obligationGroup
                    JOIN obligation.community community
                    WHERE
                    community.id = {:id}
                    AND obligationGroup IS NULL OR obligationGroup.id = {:ogid}
                    ORDER BY 
                    obligation.name ASC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>simple-list-reports</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    report.id, report.name)
                    FROM 
                    Report report
                    ORDER BY 
                    report.name ASC
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>simple-list-payment-scheduler-free-zpks</name>
        <source>simple-list.vtl</source>
        <variables>
            <var>
                <name>list</name>
                <data>
                    SELECT new pl.reaper.container.data.helpers.SimpleList(
                    zpk.id, CONCAT(zpk.number, " - ", zpk.description))
                    FROM 
                    ZakladowyPlanKont zpk
                    JOIN zpk.community c
                    LEFT OUTER JOIN c.paymentSchedulers ps
                    WHERE c.id = {:cid}
                    AND zpk.possession IS NOT NULL
                    AND zpk.id NOT IN(
                    SELECT 
                    bounded.id
                    FROM 
                    ps.zpks bounded
                    WHERE
                    ps.id = {:psid})
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>can-close-month</name>
        <source>simple-long-response.vtl</source>
        <variables>
            <var>
                <name>response</name>
                <data>
                    SELECT
                        COUNT(possession.id) as counter
                    FROM
                        Community community
                        JOIN community.possessions possession
                    WHERE
                        possession.id NOT IN(
                            SELECT 
                                charged.id 
                            FROM 
                                Charging charging
                                JOIN charging.possession charged
                            WHERE
                                charging.month IN(
                                    SELECT
                                        dict.value
                                    FROM
                                        Dictionary dict
                                        JOIN dict.type dtype
                                    WHERE
                                        dtype.type = "PERIODS"
                                        AND dict.key = "CURRENT"))
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>current-charge-month</name>
        <source>simple-long-response.vtl</source>
        <variables>
            <var>
                <name>response</name>
                <data>
                    {:single}
                    SELECT
                        dict.value
                    FROM
                        Dictionary dict
                        JOIN dict.type dtype
                    WHERE
                        dtype.type = "PERIODS"
                        AND dict.key = "CURRENT"
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>can-delete-obligation</name>
        <source>simple-long-response.vtl</source>
        <variables>
            <var>
                <name>response</name>
                <data>
                    {:single}
                    SELECT
                    count(payment.id)
                    FROM
                    Payment payment
                    JOIN payment.obligation obligation
                    WHERE
                    obligation.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>can-delete-possession</name>
        <source>simple-long-response.vtl</source>
        <variables>
            <var>
                <name>response</name>
                <data>
                    {:single}
                    SELECT
                    count(payment.id)
                    FROM
                    Payment payment
                    JOIN payment.possession possession
                    WHERE
                    possession.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>can-delete-zpk</name>
        <source>simple-long-response.vtl</source>
        <variables>
            <var>
                <name>response</name>
                <data>
                    {:single}
                    SELECT
                    count(zpk.id)
                    FROM
                    ZakladowyPlanKont zpk
                    LEFT OUTER JOIN zpk.obligation obligation
                    LEFT OUTER JOIN zpk.zpkBalances balance
                    LEFT OUTER JOIN balance.payments payment
                    LEFT OUTER JOIN zpk.obligationGroups obligationGroup
                    WHERE
                    zpk.id = {:id}
                    AND (payment.id IS NOT NULL 
                    OR obligation.id IS NOT NULL
                    OR obligationGroup.id IS NOT NULL)
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>can-delete-element</name>
        <source>simple-long-response.vtl</source>
        <variables>
            <var>
                <name>response</name>
                <data>
                    {:single}
                    SELECT
                    count(e.id)
                    FROM
                    Element e
                    LEFT OUTER JOIN e.communityElements ce
                    LEFT OUTER JOIN e.possessionElements pe
                    WHERE
                    e.id = {:id}
                    AND (ce.id IS NOT NULL 
                    OR pe.id IS NOT NULL)
                </data>
            </var>
        </variables>
    </template>
</templates>
