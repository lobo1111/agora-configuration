<?xml version="1.0" encoding="UTF-8"?>
<templates>
    <template>
        <name>update-community</name>
        <source>update-community.vtl</source>
        <variables>
            <var>
                <name>comunity</name>
                <data>
                    {:update}
                    {:native}
                    UPDATE
                        community,
                        company,
                        address AS companyAddress
                    SET 
                        community.name = \'{:communityName}\',
                        company.name = \'{:companyName}\',
                        company.nip = \'{:companyNip}\',
                        company.regon = \'{:companyRegon}\',
                        company.www = \'{:companyWww}\',
                        company.email = \'{:companyEmail}\',
                        companyAddress.street = \'{:addressStreet}\',
                        companyAddress.house_number = \'{:addressHouseNumber}\',
                        companyAddress.flat_number = \'{:addressFlatNumber}\',
                        companyAddress.postal_code = \'{:addressPostalCode}\',
                        companyAddress.city = \'{:city}\'
                    WHERE 
                        c.id = {:id} AND
                        community.company_id = company.id AND
                        company.address_id = companyAddress.id
                </data>
            </var>
        </variables>
    </template> 
    <template>
        <name>select-community</name>
        <source>community.vtl</source>
        <variables>
            <var>
                <name>community</name>
                <data>
                    {:single}
                    SELECT c FROM Community c WHERE c.id = {:id}
                </data>
            </var>
        </variables>
    </template>
    <template>
        <name>communities-names</name>
        <source>communities-names.vtl</source>
        <variables>
            <var>
                <name>communities</name>
                <data>SELECT c FROM Community c ORDER BY c.name ASC</data>
            </var>
        </variables>
    </template>
    <template>
        <name>communities-and-possessions-list</name>
        <source>communities-and-possessions-list.vtl</source>
        <variables>
            <var>
                <name>communities</name>
                <data>
                    {:limit}
                    SELECT 
                    community.name, community.area, 
                    possessionAddress.street, possessionAddress.houseNumber, possessionAddress.flatNumber, 
                    possession.area, possession.id, community.id
                    FROM 
                    Community community 
                    JOIN community.possessions possession 
                    JOIN possession.address possessionAddress
                    LEFT OUTER JOIN possession.people possessionOwnerPerson
                    LEFT OUTER JOIN possession.companies possessionOwnerCompany
                    LEFT OUTER JOIN possessionOwnerPerson.address personAddress
                    LEFT OUTER JOIN possessionOwnerCompany.address companyAddress
                    WHERE {:where}
                </data>
            </var>
            <var>
                <name>countRows</name>
                <data>
                    {:single}
                    SELECT 
                    count(community.id)
                    FROM 
                    Community community 
                    JOIN community.possessions possession 
                    JOIN possession.address possessionAddress
                    LEFT OUTER JOIN possession.people possessionOwnerPerson
                    LEFT OUTER JOIN possession.companies possessionOwnerCompany
                    LEFT OUTER JOIN possessionOwnerPerson.address personAddress
                    LEFT OUTER JOIN possessionOwnerCompany.address companyAddress
                    WHERE {:where}
                </data>
            </var>
        </variables>
    </template>
</templates>
