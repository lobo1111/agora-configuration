<?xml version="1.0" encoding="UTF-8" standalone="yes" ?> 
<entity name="invoice">
    <property name="id" type="Integer">$!entity.getId()</property>
    <property name="number" type="String">$!entity.getAttribute("NUMBER")</property>
    <property name="contractor" type="String">$!entity.getContractor().getName()</property>
    <property name="contractorId" type="String">$!entity.getContractor().getId()</property>
    <property name="creationDate" type="String">$!entity.getAttribute("CREATE_DATE")</property>
    <property name="paymentDate" type="String">$!entity.getAttribute("PAYMENT_DATE")</property>
    <list name="positions">
        #foreach($row in $entity.getPositions())
        #if($row.getType() == "INVOICE_POSITION")
        <entity name="invoice_position">
            <property name="id" type="Integer">$row.getId()</property>
            <property name="number" type="String">$!row.getAttirbute("NUMBER")</property>
            <property name="taxId" type="Integer">$!row.getAttribute("TAX")</property>
            <property name="volume" type="String">$!row.getAttribute("VOLUME")</property>
            <property name="valueUnit" type="String">$!row.getAttribute("VALUE_UNIT")</property>
        </entity>
        #end
        #end
    </list>
    <list name="payments">
        #foreach($row in $entity.getPositions())
        #if($row.getType() == "INVOICE_PAYMENT")
        <entity name="invoice_payment">
            <property name="id" type="Integer">$row.getId()</property>
            <property name="creationDate" type="String">$row.getAttribute("CREATE_DATE")</property>
            <property name="account" type="String">$row.getAccount().getNumber()</property>
            <property name="accountId" type="String">$row.getAccount().getId()</property>
            <property name="value" type="String">$row.getValue</property>
        </entity>
        #end
        #end
    </list>
</entity>